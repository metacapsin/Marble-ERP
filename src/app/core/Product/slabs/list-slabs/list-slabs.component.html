<p-toast></p-toast>
<div class="page-wrapper">
  <div class="content">
    <!-- Page Header -->
    <div class="page-header">
      <div class="row">
        <div class="col-sm-12">
          <ul class="breadcrumb">
            <li class="breadcrumb-item">
              <a [routerLink]="routes.adminDashboard">Dashboard </a>
            </li>
            <li class="breadcrumb-item">
              <i class="feather icon-chevron-right"></i>
            </li>
            <!-- <li class="breadcrumb-item active">Stock</li>
                        <li class="breadcrumb-item"><i class="feather icon-chevron-right"></i></li> -->
            <li class="breadcrumb-item active">Slabs List</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <div class="card card-table show-entire">
          <div class="card-body">
            <div class="page-table-header mb-2">
              <div class="row align-items-center">
                <div class="col">
                  <div class="doctor-table-blk">
                  <div class="d-flex col-md-3">
                    <h3 class="mt-2">Slabs List</h3>
                    <div class="add-group textbtn mx-3" style="border:1px solid #97704f; border-radius: none;">
                      <a
                        appShowHide
                        style="border:none; border-radius: none !important;padding: 10px;"
                        [roles]="['admin', 'super-admin']"
                        [routerLink]="['/slabs/slab-add']"
                        class="btn add-pluss ms-2"
                        ><img src="assets/img/icons/plus.svg" alt="" /> Add
                        New</a
                      >
                    </div>
                  </div>
                    <div class="doctor-search-blk col-md-6">
                    
                      <div class="form-group local-forms mt-3">
                        <div
                          class="top-nav-search table-search-blk d-flex mt-2"
                          style="border: 1px solid #97704f; border-radius: 1px"
                        >
                          <!-- Warehouse Dropdown -->
                          <p-dropdown
                            [options]="warehouseData"
                            styleClass=""
                            appendTo="body"
                            placeholder="Select Warehouse"
                            [style]="{border:'none', minWidth:'200px' }"
                            [filter]="true"
                            optionLabel="name"
                            optionValue="_id"
                            [showClear]="true"
                            class="w-full md:w-56"
                            (onChange)="onSearchByChange($event.value)"
                            [(ngModel)]="warehouseDropDown"
                          ></p-dropdown>

                          <!-- Search Input with Icon -->
                          <div style="position: relative; width: 95%;">
                            <input
                              type="text"
                              class="form-control bg-white"
                              placeholder="Enter Key Word here"
                              #searchTable
                              (input)="dt.filterGlobal(searchTable.value, 'contains') ; onSearchInput($event)"

                              style="
                               border-left: 2px solid #e8e8e8;
                                border-radius: 0px 0 0 0px;
                                width: 100%;
                                padding-right: 0px;
                              "
                            />
                            <!-- Search Icon -->
                            <a
                              class="btn"
                              style="
                                position: absolute;
                                left: 84% !important;
                                top: 49.9%;
                                transform: translateY(-50%);
                                background-color: #97704f;
                                border-radius: 0px;
                              "
                            >
                              <!-- <img src="assets/img/icons/search-normal.svg" alt="" /> -->
                              <i class="fas fa-search text-white"></i>
                            </a>
                          </div>
                          
                        </div>
                        
                      </div>
                   
                      
                    </div>
                    <div class="col-md-2 mt-3 h-2 ">
                      <div class="form-group local-forms">
                        <!-- <label for="warehouseDetails">Layout</label> -->
                        <p-dropdown
                          [options]="isViewsystemtyp"
                          appendTo="body"
                          placeholder="Choose Layout"
                          [style]="{ width: '100%', borderBottom: '1px solid #97704f', borderTop: 'none', borderLeft: 'none', borderRight: 'none' }"
                          [filter]="true"
                          optionLabel="value"
                          optionValue="code"
                          [showClear]="false"
                          (onChange)="onchangeLayout($event.value)"
                          [(ngModel)]="selectedLayout"
                        >
                        </p-dropdown>
                      </div>
                   
                    </div>
                    <div class="col-auto text-end float-end ms-auto download-grp" >
                      <!-- <a href="javascript:;" class="me-2"><img src="assets/img/icons/pdf-icon-01.svg" alt=""  pTooltip="Download data in PDF file" tooltipPosition="left"
                                            tooltipStyleClass="tooltip" /></a> -->
                      <a href="javascript:;" class="me-2"><img src="assets/img/icons/pdf-icon-03.svg" alt="" pTooltip="Download data in CSV file " tooltipPosition="left"
                        (click)="dt.exportCSV()"         tooltipStyleClass="tooltip" /></a>
                    </div>
                  </div>
                </div>
            
              </div>
            
            </div>
            <div class="card-body p-2">
              <span *ngIf="selectedLayout === 'Card'" class="col-12 col-md-12">
                <div class="p-2"><strong>Total Available Stock :</strong> <span  style="font-weight: 500;"> {{ totalSqFtLeft | indianCurrency }} Sq. Feet</span></div>
                <div class="container mt-4" *ngFor="let item of pagedData">
                  <div class="row">
                    <div class="col-md-8 container-box">
                      <div
                        class="d-flex justify-content-between align-items-center"
                      >
                        <h4 class="header-text">
                          {{ item?.subCategoryDetail?.name }}
                          <span class="text-muted"
                            >({{ item?.categoryDetail?.name }})</span
                          >
                        </h4>
                        <div
                          class="d-flex justify-content-between align-items-center"
                        >
                          <a (click)="getSlabDetailsById(item?._id)" class="view-more"  pTooltip="View More" tooltipPosition="bottom"
                            ><i class="fa-solid fa-eye"></i
                          ></a>
                          <a (click)="deleteSlabs(item?._id)" class="view-more"  pTooltip="Delete" tooltipPosition="bottom"
                            ><i class="fa-solid fa-trash"></i
                          ></a>
                          <a  (click)="showSlabHistoryDetails(item?._id)" class="view-more"  pTooltip="Sales History" tooltipPosition="bottom"
                            ><i class="fa-solid fa-clock-rotate-left"></i
                          ></a>
                          <!-- <button class="view-more-btn" (click)="showSlabDetails(item?._id)">
                            View More
                            <i class="fas fa-arrow-right mx-3"></i> 
                          </button> -->
                        </div>
                      </div>
                      <hr />
                      <div class="row text-muted">
                        <div class="col">
                          <strong>Slab Name</strong><br />{{ item?.slabName }}
                        </div>
                        <div class="col">
                          <strong>Slab Number</strong><br />{{ item?.slabNo }}
                        </div>
                        <div class="col">
                          <strong>Size</strong><br />{{ formatSlabSize(item?.slabSize) }}
                        </div>
                   
                        <div class="col">
                          <strong>Stock Entry Date </strong><br />
                          {{ item?.date | date : "dd-MMM-yyyy" }}
                        </div>
                      </div>
                      <div class="row mt-3 text-muted">
                        <div class="col">
                          <strong>Available Stock</strong><br />{{
                            item?.totalSQFT | indianCurrency
                          }} Sq. Feet
                        </div>
                        <div class="col">
                          <strong>Initial Stock</strong><br />{{
                            item?.totalSlabSQFT | indianCurrency
                          }}  Sq. Feet
                        </div>
                        <div class="col">
                          <strong>Cost/Sq. Feet</strong><br />&#8377;
                          {{ item?.costPerSQFT | indianCurrency }}
                        </div>
                        <div class="col">
                          <strong>Warehouse</strong><br />{{
                            item?.warehouseDetails?.name
                          }}
                        </div>
                      </div>
                      <div class="progress mt-3">
                        <div
                          class="progress-bar"
                          role="progressbar"
                          [style.width.%]="(item?.totalSQFT / item?.totalSlabSQFT) * 100"
                          [attr.aria-valuenow]="item?.totalSQFT" 
                          [attr.aria-valuemin]="0"
                          [attr.aria-valuemax]="item?.totalSlabSQFT" 
                        ></div>
                      </div>
                      
                    </div>
                    <div class="col-md-4 sales-revenue">
                      <div
                        class="d-flex justify-content-between align-items-center"
                      >
                        <h4>Sales Revenue</h4>
                        <!-- <button class="view-more-btn" (click)="showSlabHistoryDetails(item?._id)">
                          <i class="fas fa-arrow-right"></i> 
                        </button> -->
                      </div>
                      <hr />
                      <p class="sales-detail">
                        <strong>Total Sales:</strong>₹ {{ item?.slabHistory?.totalSales?.toFixed(2) }}
                      </p>
                      <!-- <p class="sales-detail">
                        <span class="label">Tax Amount:</span>
                        <span class="value">₹ {{item?.slabHistory?.totalTaxAmount ?item?.slabHistory?.totalTaxAmount.toFixed(2) : "0"}}</span>
                      </p> -->
                      <p class="sales-detail">
                        <span class="label">Cost Of Goods Sold:</span>
                        <span class="value">₹ {{item?.slabHistory?.totalCostPerSQFT || 0}}</span>
                      </p>
                      <p class="sales-detail">
                        <span class="label">Tax Profit:</span>
                        <span class="value">₹ {{item?.slabHistory?.taxProfit || 0}}</span>
                      </p>
                      <p class="sales-detail">
                        <span class="label">Profit/Loss:</span>
                        <span class="value">₹ {{item?.slabHistory?.profit || 0}}</span>
                      </p>
                     
                    
                    </div>
                  </div>
                </div>

                <div *ngIf="!allSlabsDaTa && showDataLoader"
                colspan="10"
                class="text-center"
              >
                      <p-progressSpinner ariaLabel="loading" />
                </div>
                <p-paginator
                *ngIf="totalRecords > 0"
                  [first]="currentPage * rowsPerPage"
                  [rows]="rowsPerPage"
                  [totalRecords]="totalRecords"
                  [rowsPerPageOptions]="[5, 10, 20]"
                  (onPage)="paginate($event)"
                  (onPageChange)="paginate($event)"
                >
                </p-paginator>

                <p
                colspan="10"
                class="text-center"
                *ngIf="totalRecords <= 0"
              >
                No slabs found.
              </p>
              </span>

              <span
                [ngStyle]="{
                  display: selectedLayout === 'Card' ? 'none' : 'block'
                }"
              >
                <p-table
                  [value]="allSlabsDaTa"
                  [tableStyle]="{ 'min-width': '60rem' }"
                  [paginator]="allSlabsDaTa?.length >= 5"
                  [rows]="10"
                  [rowsPerPageOptions]="[5, 10, 20]"
                  styleClass="p-datatable-striped"
                  (onPage)="onPageChange($event)"
                  [(selection)]="selectedSlabs"
                  #dt
                  [columns]="cols"
                  [exportHeader]="'customExportHeader'"
                  exportFilename="Slabs"
                  [globalFilterFields]="[
                    'slabNo',
                    'slabName',
                    'slabSize',
                    'categoryDetail?.name',
                    'subCategoryDetail?.name',
                    'totalSQFT',
                    'costPerSQFT',
                    'sellingPricePerSQFT',
                    'warehouseDetails?.name'
                  ]"
                >
                  <ng-template pTemplate="header">
                    <tr>
                      <th pSortableColumn="slabNo">
                        Slab Number<p-sortIcon field="slabNo"></p-sortIcon>
                        <p-columnFilter
                          matchMode="contains"
                          hideOnClear="true"
                          type="text"
                          field="slabNo"
                          display="menu"
                        ></p-columnFilter>
                      </th>
                      <th pSortableColumn="slabName">
                        Slab Name<p-sortIcon field="slabName"></p-sortIcon>
                        <p-columnFilter
                          matchMode="contains"
                          hideOnClear="true"
                          type="text"
                          field="slabName"
                          display="menu"
                        ></p-columnFilter>
                      </th>
                      <th pSortableColumn="slabSize">
                        Size<p-sortIcon field="slabSize"></p-sortIcon>
                        <p-columnFilter
                          matchMode="contains"
                          hideOnClear="true"
                          type="text"
                          field="slabSize"
                          display="menu"
                        ></p-columnFilter>
                      </th>
                      <th pSortableColumn="categoryDetail?.name">
                        Category<p-sortIcon
                          field="categoryDetail?.name"
                        ></p-sortIcon>
                        <p-columnFilter
                          matchMode="contains"
                          hideOnClear="true"
                          type="text"
                          field="categoryDetail?.name"
                          display="menu"
                        ></p-columnFilter>
                      </th>
                      <th pSortableColumn="subCategoryDetail?.name">
                        Sub Category<p-sortIcon
                          field="subCategoryDetail?.name"
                        ></p-sortIcon>
                        <p-columnFilter
                          matchMode="contains"
                          hideOnClear="true"
                          type="text"
                          field="subCategoryDetail?.name"
                          display="menu"
                        ></p-columnFilter>
                      </th>

                      <th pSortableColumn="costPerSQFT">
                        Cost / Sq. Feet<p-sortIcon
                          field="costPerSQFT"
                        ></p-sortIcon>
                        <p-columnFilter
                          matchMode="contains"
                          hideOnClear="true"
                          type="text"
                          field="costPerSQFT"
                          display="menu"
                        ></p-columnFilter>
                      </th>
                      <th pSortableColumn="sellingPricePerSQFT">
                        Selling Price<p-sortIcon
                          field="sellingPricePerSQFT"
                        ></p-sortIcon>
                        <p-columnFilter
                          matchMode="contains"
                          hideOnClear="true"
                          type="text"
                          field="sellingPricePerSQFT"
                          display="menu"
                        ></p-columnFilter>
                      </th>
                      <th pSortableColumn="totalSQFT">
                        Sq. Feet Left<p-sortIcon field="totalSQFT"></p-sortIcon>
                        <p-columnFilter
                          matchMode="contains"
                          hideOnClear="true"
                          type="text"
                          field="totalSQFT"
                          display="menu"
                        ></p-columnFilter>
                      </th>
                      <th pSortableColumn="warehouseDetails?.name">
                        Warehouse<p-sortIcon
                          field="warehouseDetails?.name"
                        ></p-sortIcon>
                        <p-columnFilter
                          matchMode="contains"
                          hideOnClear="true"
                          type="text"
                          field="warehouseDetails?.name"
                          display="menu"
                        ></p-columnFilter>
                      </th>
                      <th width="5%">Action</th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-slabs>
                    <tr>
                      <td>
                        {{ slabs?.slabNo }}
                      </td>
                      <td>
                        {{ slabs?.slabName }}
                      </td>
                      <td>
                        {{ formatSlabSize(slabs?.slabSize) }}
                      </td>
                      <td>
                        {{ slabs?.categoryDetail?.name }}
                      </td>
                      <td>
                        {{ slabs?.subCategoryDetail?.name }}
                      </td>

                      <td>₹ {{ slabs?.costPerSQFT | indianCurrency }}</td>
                      <td>
                        ₹ {{ slabs?.sellingPricePerSQFT | indianCurrency }}
                      </td>
                      <td>
                        {{ slabs?.totalSQFT | indianCurrency }}
                      </td>
                      <td>
                        {{ slabs?.warehouseDetails?.name }}
                      </td>
                      <td
                        appShowHide
                        [roles]="['admin', 'super-admin']"
                        class="action-buttons"
                      >
                        <p-button
                          [text]="true"
                          icon="fa-solid fa-eye"
                          pTooltip="View"
                          tooltipPosition="left"
                          tooltipStyleClass="tooltip"
                          (click)="getSlabDetailsById(slabs?._id)"
                        ></p-button>
                        <p-button
                          [text]="true"
                          icon="fa-solid fa-trash"
                          pTooltip="View"
                          tooltipPosition="left"
                          tooltipStyleClass="tooltip"
                          (click)="deleteSlabs(slabs?._id)"
                        ></p-button>
                        <p-button
                          [text]="true"
                          icon="fa-solid fa-clock-rotate-left"
                          (click)="showSlabHistoryDetails(slabs?._id)"
                          pTooltip="History"
                          tooltipPosition="left"
                          tooltipStyleClass="tooltip"
                        ></p-button>
                      </td>
                      <!-- <td appShowHide [roles]="['admin', 'super-admin']">
                                            <div class="action-buttons">

                                                <p-button === false" [text]="true" icon="fa fa-edit"
                                                    (click)="updateSlabs(slabs._id)"></p-button>
                                                <p-button === false" [text]=" true" icon="fa fa-trash"
                                                (click)="deleteSlabs(slabs._id)"></p-button>
                                            </div>
                                        </td> -->
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="emptymessage">
                    <tr>
                      <td
                        *ngIf="!allSlabsDaTa && showDataLoader"
                        colspan="10"
                        class="text-center"
                      >
                        <p-progressSpinner ariaLabel="loading" />
                      </td>
                    </tr>
                    <tr>
                      <td
                        colspan="10"
                        class="text-center"
                        *ngIf="!showDataLoader"
                      >
                        No slabs found.
                      </td>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="footer">
                    <tr>
                      <td colspan="6"></td>
                      <td *ngIf="allSlabsDaTa">Total Available Stock</td>
                      <td class="total-sqft">
                        {{ totalSqFtLeft | indianCurrency }}Sq. Feet
                      </td>
                      <td colspan="2"></td>
                    </tr>
                  </ng-template>

                  <!-- <ng-template>
                                        <td *ngIf="!allSlabsDaTa && showDataLoader" colspan="10" class="text-center">
                                            <p-progressSpinner ariaLabel="loading" />
                                        </td>
                                    </ng-template> -->
                </p-table>
              </span>
            </div>
          </div>
        </div>
        <!-- <div class=""><p-progressSpinner ariaLabel="loading" /></div> -->
      </div>
    </div>
  </div>
</div>

<app-confirm-dialog
  [showDialog]="showDialog"
  (callbackModal)="callBackModal()"
  (close)="close()"
  [data]="modalData"
></app-confirm-dialog>

<!-- ----------------Slab Details Pop Up --------------- -->

<p-dialog
  header="Slab Details"
  [(visible)]="slabVisible"
  [modal]="true"
  [style]="{ width: '80vw' }"
  (onHide)="closeDialog()">


  <div class="card">
    <div class="modal-content">
      <div class="modal-body">
        <div class="card-body">
          <div class="card card-table show-entire">
            <div class="row practice-card p-2 m-2">
              <div class="col-xl-6 col-lg-6 col-sm-12">
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Slab Name
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-lg-9 col-form-label">
                      {{ slabDetail?.slabName }}
                    </p>
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Creation Date
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-lg-9 col-form-label">
                      {{ slabDetail?.date | date : "dd-MMM-yyyy" }}
                    </p>
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Category
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">
                      {{ slabDetail?.categoryDetail?.name }}
                    </p>
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Size
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">{{ formatSlabSize(slabDetail?.slabSize) }}</p>
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Cost / Sq. Feet
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">
                      ₹ {{ slabDetail?.costPerSQFT | indianCurrency }}
                    </p>
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Available Stock
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">{{ slabDetail?.totalSQFT | indianCurrency}} Sq. Feet</p>
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Initial Stock
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">
                      {{ slabDetail?.totalSlabSQFT }} Sq. Feet
                    </p>
                  </div>
                </div>
<!-- 
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Total Slab Cost
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">
                      ₹ {{ +slabDetail?.totalCosting | indianCurrency }}
                    </p>
                  </div>
                </div> -->
              </div>
              <div class="col-xl-6 col-lg-6 col-sm-12">
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Slab Number
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">{{ slabDetail?.slabNo }}</p>
                  </div>
                </div>

                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Warehouse
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">
                      {{ slabDetail?.warehouseDetails?.name }}
                    </p>
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Sub Category
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">
                      {{ slabDetail?.subCategoryDetail?.name }}
                    </p>
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Thickness
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">{{ slabDetail?.thickness }} MM</p>
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    No of Pieces
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">{{ slabDetail?.noOfPieces }}</p>
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Selling Price / Sq. Feet.
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">
                      ₹ {{ slabDetail?.sellingPricePerSQFT | indianCurrency }}
                    </p>
                  </div>
                </div>
                <!-- <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Initial Stock
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">
                      {{ slabDetail?.totalSlabSQFT }} Sq. Feet
                    </p>
                  </div>
                </div> -->

                <!-- <div class="form-group row mb-2">
                  <h5 class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                    Slab Sales
                  </h5>
                  <div class="col-lg-9 col-md-9 col-xl-9">
                    <p class="col-form-label">
                      <span class="amount-bold"
                        >₹ {{ slabProfit | indianCurrency }}
                      </span>
                      <span
                        >( Sales : ₹
                        {{ +slabDetail?.totalSales | indianCurrency }} - Sales
                        Return : ₹
                        {{
                          slabDetail?.totalSalesReturn | indianCurrency
                        }})</span
                      >
                    </p>
                  </div>
                </div> -->
              </div>
            </div>
          </div>
          <div class="invoice-add-table">
            <div class="card" *ngIf="mergedExpenseData?.length > 0" >
              <p-tabView>
                 <p-tabPanel header="Slab Expenses">
                  <div class="card-body p-2">
                    <p-table [value]="mergedExpenseData" styleClass="p-datatable-striped"
                    [tableStyle]="{ 'min-width': '60rem' }">
                    <ng-template pTemplate="header">
                      <tr>
                        <th>Date</th>
                        <th>Slab Name</th>
                        <th>Slab Number</th>
                        <th>Expense Type</th>
                        <th>Processor / Recipient </th>
                        <th>Amount</th>
                        <th>Action</th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-expense>
                      <tr>
                        <td>{{ expense.date | date : "dd-MMM-yyyy" }}</td>
                        <td>{{ expense.slab?.slabName }}</td>
                        <td>{{ expense.slab?.slabNo }}</td>
                        <td>{{ expense.type }}</td>
                        <td>{{ expense.recipient || expense.processorName }}</td>
                        <td>{{ expense.amount || expense.processingCost }}</td>
                        <td>
                          <p-button [text]="true" icon="fa fa-trash" (click)="deleteExpense(expense._id, 'expense')"
  pTooltip="Delete" tooltipPosition="bottom" tooltipStyleClass="tooltip">
</p-button>
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
                </p-tabPanel>
              </p-tabView>
            </div>
          
            <button type="button" class="border-0 btn btn-primary btn-gradient-primary m-r-10"
                            (click)="addExpense()" [disabled]="!canAddExpense"  >
                            Add Slab Expenses
                        </button>
          </div>
    <div *ngIf="formVisible">

      <div *ngFor="let expense of expenses; let i = index" class="expense-row">
        <div class="row">
          <!-- Expense Type -->
          <div class="col-xl-3 col-md-6 col-sm-12 col-12">
            <div class="form-group local-forms">
              <label>Expense Type <span class="login-danger">*</span></label>
              <p-dropdown 
                [options]="expenseOptions" 
                [(ngModel)]="expense.expenseType" 
                placeholder="Select Expense Type"
                (onChange)="onExpenseTypeChange(expense)">
              </p-dropdown>
            </div>
          </div>
      
          <!-- Fields for Other Expense (Row 1) -->
          <ng-container *ngIf="expense.expenseType === 'Other Expense'">
            
      
            <div class="col-xl-3 col-md-6 col-sm-12 col-12">
              <div class="form-group local-forms">
                <label>Date <span class="login-danger">*</span></label>
                <p-calendar 
                  dataType="string" 
                  appendTo="body" 
                  dateFormat="mm/dd/yy" 
                  [(ngModel)]="expense.date" 
                  placeholder="mm/dd/yyyy" 
                  [styleClass]="'col-12'">
                </p-calendar>
              </div>
            </div>
            <div class="col-xl-3 col-md-6 col-sm-12 col-12">
              <div class="form-group local-forms">
                <label>Recipient <span class="login-danger">*</span></label>
                <input type="text" [(ngModel)]="expense.recipient" class="form-control" placeholder="Enter recipient" required />
              </div>
            </div>
            <div class="col-xl-3 col-md-6 col-sm-12 col-12">
              <div class="form-group local-forms">
                <label>Amount <span class="login-danger">*</span></label>
                <input type="number" [(ngModel)]="expense.amount" class="form-control" placeholder="Amount" required />
              </div>
            </div>
          </ng-container>
      
          <!-- Fields for Block/Slab Processing (Row 1) -->
          <ng-container *ngIf="expense.expenseType === 'Block/Slab Processing'">
            <div class="col-xl-3 col-md-6 col-sm-12 col-12">
              <div class="form-group local-forms">
                <label>Processing Date <span class="login-danger">*</span></label>
                <p-calendar 
                  dataType="string" 
                  appendTo="body" 
                  dateFormat="mm/dd/yy" 
                  [(ngModel)]="expense.processingDate" 
                  placeholder="mm/dd/yyyy" 
                  [styleClass]="'col-12'">
                </p-calendar>
              </div>
            </div>

            <div class="col-xl-3 col-md-6 col-sm-12 col-12">
              <div class="form-group local-forms">
                <label>Block Processor <span class="login-danger">*</span></label>
                <p-dropdown 
                  [options]="blockProcessorList" 
                  [(ngModel)]="expense.blockProcessor"
                  optionLabel="name"
                  [filter]="true"
                  filterBy="name"
                  placeholder="Select Processor"
                  (onChange)="onBlockProcessorSelect(expense, $event.value)" width="100%">
                </p-dropdown>
              </div>
            </div>
      
            <div class="col-xl-3 col-md-6 col-sm-12 col-12">
              <div class="form-group local-forms">
                <label>Processing Cost <span class="login-danger">*</span></label>
                <input type="number" [(ngModel)]="expense.processingCost" class="form-control" placeholder="Processing Cost" required />
              </div>
            </div>

            
          </ng-container>
        </div>
      
        <div class="row ">
      
          <!-- Fields for Block/Slab Processing (Row 2) -->
          <ng-container *ngIf="expense.expenseType === 'Block/Slab Processing'">
            
          </ng-container>
      
          <!-- Action Buttons (Save & Delete) -->
            <div class="col-md-12 col-sm-12 text-end mb-2" *ngIf="expense.expenseType" > 
              <button type="submit" (click)="saveExpenses()" class="border-0 btn btn-primary btn-gradient-primary m-r-10"
              [disabled]="!isFormValid()">
                Submit
              </button>
              <button class="btn btn-secondary" (click)="removeExpense(i)">
                <a class="text-white"></a>Cancel
              </button>
            </div>
        </div>
      
        <hr />
      </div>
    </div>
          
         

          <div class="card-body p-2">
            <div class="row mt-3">
              <div class="col-lg-7 col-md-6">
                <div class="invoice-fields">
                  <h4 class="field-title">More Details</h4>
                </div>
                <div class="invoice-faq">
                  <div class="col-lg-8 col-md-8">
                    <div class="invoice-terms">
                      <h6>Notes:</h6>
                      <p class="mb-0">
                        {{ slabDetail?.notes }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-5 col-md-6">
                <div class="invoice-total-card">
                  <h4 class="invoice-total-title">Summary</h4>
                  <div class="invoice-total-box">
                    <div class="invoice-total-inner">
                      <p>
                        Purchase Cost.
                        <span
                          >₹
                          {{ slabDetail?.purchaseCost | indianCurrency }}</span
                        >
                      </p>
                      <!-- <p *ngIf="slabDetail?.processingFeePerSQFT && slabDetail.processingFeePerSQFT >= 1">
                        Processing Fee/ SQFT.
                        <span
                          >₹
                          {{ slabDetail?.processingFeePerSQFT | indianCurrency }}</span
                        >
                      </p> -->
                      <p *ngIf="slabDetail?.transportationCharges">
                        Transportation Charges
                        <span
                          >₹
                          {{
                            slabDetail?.transportationCharges | indianCurrency
                          }}</span
                        >
                      </p>
                      <p *ngIf="slabDetail?.otherCharges">
                        Other Charges
                        <span
                          >₹
                          {{ slabDetail?.otherCharges | indianCurrency }}</span
                        >
                      </p>
                      <p *ngIf="slabDetail?.processingFee">
                        Processing Fee/Ton.
                        <span
                          >₹
                          {{ slabDetail?.processingFee | indianCurrency }}</span
                        >
                      </p>
                      <p *ngIf="slabDetail?.processingCost">
                        Processing Cost.
                        <span
                          >₹
                          {{
                            slabDetail?.processingCost | indianCurrency
                          }}</span
                        >
                      </p>
                      <!-- <p *ngIf="slabDetail?.totalSlabCost
                      ">
                        Total Slab Cost.
                        <span>₹
                          {{
                          slabDetail?.totalSlabCost
                          | indianCurrency
                          }}</span>
                      </p> -->
                    </div>

                    <div class="invoice-total-footer">
                      <h4>
                        Total Amount
                        <span
                          >₹
                          {{ slabDetail?.totalSlabCost | indianCurrency }}</span
                        >
                      </h4>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</p-dialog>
<p-dialog
  [(visible)]="visibleSlabHistory"
  [modal]="true"
  [draggable]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  [style]="{ width: '80vw', height: '80vh' }"
  [resizable]="false"
  header="Slab History"
>
  <div class="row">
    <div class="col-sm-12">
      <div class="card card-table show-entire">
        <div class="page-table-header mb-2 m-3">
          <div class="row practice-card">
            <div class="col-xl-6 col-lg-6 col-sm-12">
              <div class="form-group row mb-2">
                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                  Total Sales
                </h5>
                <div class="col-lg-8 col-md-8 col-xl-8">
                  <p
                    class="col-lg-9 col-form-label"
                    *ngIf="
                      slabProfitOfSlabHistory[0]?.totalSales != 0 &&
                      slabProfitOfSlabHistory[0]?.totalSales != null
                    "
                  >
                    ₹
                    {{
                      slabProfitOfSlabHistory[0]?.totalSales | indianCurrency
                    }} <span>(Tax Amount :
                      {{
                        slabProfitOfSlabHistory[0]?.totalTaxAmount 
                         ? slabProfitOfSlabHistory[0]?.totalTaxAmount.toFixed(2) : "0"
                     }} )
                    </span>
                  </p>
                  <p
                    class="col-lg-9 col-form-label"
                    *ngIf="
                      (slabProfitOfSlabHistory[0]?.totalSales == 0 ||
                        slabProfitOfSlabHistory[0]?.totalSales == null) &&
                      slabProfitOfSlabHistory[0] != null
                    "
                  >
                    0
                  </p>
                  <p
                    class="col-lg-9 col-form-label"
                    *ngIf="slabProfitOfSlabHistory[0] == null"
                  >
                    0
                  </p>
                </div>
              </div>
              <div class="form-group row mb-2">
                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                  Cost of Goods Sold (-)
                </h5>
                <div class="col-lg-8 col-md-8 col-xl-8">
                  <p
                    class="col-lg-9 col-form-label"
                    *ngIf="
                      slabProfitOfSlabHistory[0]?.totalCostPerSQFT != 0 &&
                      slabProfitOfSlabHistory[0]?.totalCostPerSQFT != null
                    "
                  >
                    ₹
                    {{
                      slabProfitOfSlabHistory[0]?.totalCostPerSQFT
                        | indianCurrency
                    }}
                  </p>
                  <p
                    class="col-lg-9 col-form-label"
                    *ngIf="
                      (slabProfitOfSlabHistory[0]?.totalCostPerSQFT == 0 ||
                        slabProfitOfSlabHistory[0]?.totalCostPerSQFT == null) &&
                      slabProfitOfSlabHistory[0] != null
                    "
                  >
                    0
                  </p>
                  <p
                    class="col-lg-9 col-form-label"
                    *ngIf="slabProfitOfSlabHistory[0] == null"
                  >
                    0
                  </p>
                </div>
              </div>
              <div class="form-group row mb-2">
                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                  Tax Profit
                </h5>
                <div class="col-lg-8 col-md-8 col-xl-8">
                  <p
                    class="col-form-label"
                    *ngIf="
                      slabProfitOfSlabHistory[0]?.taxProfit != 0 &&
                      slabProfitOfSlabHistory[0]?.taxProfit != null
                    "
                  >
                    ₹
                    {{ slabProfitOfSlabHistory[0]?.taxProfit | indianCurrency }}
                  </p>
                  <p
                    class="col-form-label"
                    *ngIf="
                      (slabProfitOfSlabHistory[0]?.taxProfit == 0 ||
                        slabProfitOfSlabHistory[0]?.taxProfit == null) &&
                      slabProfitOfSlabHistory[0] != null
                    "
                  >
                    0
                  </p>
                  <p
                    class="col-form-label"
                    *ngIf="slabProfitOfSlabHistory[0] == null"
                  >
                    0
                  </p>
                </div>
              </div>
              <div class="form-group row mb-2">
                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                  Profit / Loss
                </h5>
                <div class="col-lg-8 col-md-8 col-xl-8">
                  <p
                    class="col-form-label"
                    *ngIf="
                      slabProfitOfSlabHistory[0]?.profit != null &&
                      slabProfitOfSlabHistory[0]?.profit != 0
                    "
                  >
                    ₹ {{ slabProfitOfSlabHistory[0]?.profit | indianCurrency }}
                  </p>
                  <p
                    class="col-form-label"
                    *ngIf="
                      (slabProfitOfSlabHistory[0]?.profit == 0 ||
                        slabProfitOfSlabHistory[0]?.profit == null) &&
                      slabProfitOfSlabHistory[0] != null
                    "
                  >
                    0
                  </p>
                  <p
                    class="col-form-label"
                    *ngIf="slabProfitOfSlabHistory[0] == null"
                  >
                    0
                  </p>
                </div>
              </div>
            </div>
            <div class="col-xl-6 col-lg-6 col-sm-12">
          
              <div class="form-group row mb-2">
                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                  Initial Stock
                </h5>
                <div class="col-lg-8 col-md-8 col-xl-8">
                  <p class="col-lg-9 col-form-label">
                    {{
                      slabDetailsOfSlabHistory[0]?.totalSlabSQFT
                        ? slabDetailsOfSlabHistory[0]?.totalSlabSQFT
                        : "0"| indianCurrency
                    }} Sq.Feet
                  </p>
                </div>
              </div>
              <div class="form-group row mb-2">
                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                  Sold Stock 
                </h5>
                <div class="col-lg-8 col-md-8 col-xl-8">
                  <p class="col-lg-9 col-form-label">
                    {{
                      slabProfitOfSlabHistory[0]?.totalSalesItemQuantity
                        ? slabProfitOfSlabHistory[0]?.totalSalesItemQuantity
                        : "0"
                    }} Sq.Feet
                  </p>
                </div>
              </div>
              <div class="form-group row mb-2">
                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                  Available Stockff
                </h5>
                <div class="col-lg-8 col-md-8 col-xl-8">
                  <p class="col-lg-9 col-form-label">
                    {{
                     ( slabDetailsOfSlabHistory[0]?.currentSlabSQFT
                        ? slabDetailsOfSlabHistory[0]?.currentSlabSQFT
                        : "0")| indianCurrency
                    }} Sq.Feet
                  </p>
                </div>
              </div>
              <div class="form-group row mb-2">
                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                  Increased Measurement
                </h5>
                <div class="col-lg-8 col-md-8 col-xl-8">
                  <p class="col-lg-9 col-form-label">
                    {{
                       slabProfitOfSlabHistory[0]?.increasedMeasurement 
                        ? (slabProfitOfSlabHistory[0]?.increasedMeasurement).toFixed(2)
                        : "0.00"                        
                    }} Sq.Feet
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <p-tabView [(activeIndex)]="activeTabIndex">
      <p-tabPanel header="Sales">
        <p-table
          selectionMode="multiple"
          [value]="slabHistoryData?.sales"
          styleClass="p-datatable-striped"
          [tableStyle]="{ 'min-width': '60rem' }"
          [paginator]="data?.length >= 5"
          [rows]="10"
          [rowsPerPageOptions]="[5, 10, 20]"
        >
          <ng-template pTemplate="header">
            <tr class="text-center">
              <th pSortableColumn="salesInvoiceNumber">
                Invoice Number
                <p-sortIcon field="salesInvoiceNumber"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="salesInvoiceNumber"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="salesDate">
                Sales Date <p-sortIcon field="salesDate"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="salesDate"
                  display="menu"
                ></p-columnFilter>
              </th>
              <!-- <th pSortableColumn="salesItemQuantity">
                Quantity
                <p-sortIcon field="salesItemQuantity"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="salesItemQuantity"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="salesItemUnitPrice">
                Rate
                <p-sortIcon field="salesItemUnitPrice"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="salesItemUnitPrice"
                  display="menu"
                ></p-columnFilter>
              </th> -->
              <th pSortableColumn="paymentStatus">
                Payment Status <p-sortIcon field="paymentStatus"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="paymentStatus"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="paidAmount">
                Paid Amount <p-sortIcon field="paidAmount"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="paidAmount"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="dueAmount">
                Due Amount <p-sortIcon field="dueAmount"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="dueAmount"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="salesTotalAmount">
                Total Amount
                <p-sortIcon field="salesTotalAmount"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="salesTotalAmount"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th >
                    Action
                  </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-sales>
            <tr >
              <td style="cursor: pointer;" (click)="viewSales(sales._id)"  >{{ sales?.salesInvoiceNumber }}</td>
              <td>{{ sales?.salesDate | date : "dd-MMM-yyyy" }}</td>
              <!-- <td>{{ item?.salesItemQuantity }}</td>
              <td>{{ item?.salesItemUnitPrice }}</td> -->
              <!-- <td>{{ getTotalQuantity(sales) }}</td>

              <td>
                {{ sales?.salesItemDetails[0]?.salesItemUnitPrice }}
              </td> -->
              <td *ngIf="sales?.paymentStatus == 'Partial Paid'">
                <p-tag severity="warning" value="Partial Paid"></p-tag>
              </td>
              <td *ngIf="sales?.paymentStatus == 'Paid'">
                <p-tag severity="success" value="Paid"></p-tag>
              </td>
              <td *ngIf="sales?.paymentStatus == 'Unpaid'">
                <p-tag severity="danger" value="Unpaid"></p-tag>
              </td>
              <td>₹ {{ sales?.paidAmount | indianCurrency }}</td>
              <td>₹ {{ sales?.dueAmount | indianCurrency }}</td>
              <td>₹ {{ sales?.salesTotalAmount | indianCurrency }}</td>
              <td>
                <p-button
                          [text]="true"
                          icon="fa-solid fa-eye"
                          pTooltip="View"
                          tooltipPosition="left"
                          tooltipStyleClass="tooltip"
                          (click)="viewSales(sales?._id)"
                        ></p-button>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="8" class="text-center">No sales records found.</td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>

      <!-- Stock Adjustment Grid -->
      <p-tabPanel header="Stock Adjustment">
        <p-table
          selectionMode="multiple"
          [value]="slabHistoryData?.adjustments"
          styleClass="p-datatable-striped"
          [tableStyle]="{ 'min-width': '60rem' }"
          [paginator]="data?.length >= 5"
          [rows]="10"
          [rowsPerPageOptions]="[5, 10, 20]"
        >
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="createdOn">
                Adjustment Date <p-sortIcon field="createdOn"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="createdOn"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="slabs?.slabName">
                Slab Name <p-sortIcon field="slabs?.slabName"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="slabs?.slabName"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="warehouse?.name">
                Warehouse <p-sortIcon field="warehouse?.name"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="warehouse?.name"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="adjustmentType">
                Adjustment Type <p-sortIcon field="adjustmentType"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="adjustmentType"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="previousQty">
                Previous Qty<p-sortIcon field="previousQty"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="previousQty"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="quantity">
                Adjustment Qty<p-sortIcon field="quantity"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="quantity"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="currentQty">
                Adjusted Qty<p-sortIcon field="currentQty"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="currentQty"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="note">
                Notes<p-sortIcon field="note"></p-sortIcon>
                <p-columnFilter matchMode="contains" hideOnClear="true" type="text" field="note"
                  display="menu"></p-columnFilter>
              </th>
              <!-- <th width="13%">Action</th> -->
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-stock>
            <tr>
              <td>{{ stock?.createdOn | date : "dd-MMM-yyyy" }}</td>
              <td>{{ stock?.slabs?.slabName }}</td>
              <td>{{ stock?.warehouse?.name }}</td>
              <td>{{ stock?.adjustmentType?.toUpperCase() }}</td>
              <td>{{ stock?.previousQty + " Sq. Feet. " }}</td>
              <td>{{ stock?.quantity + " Sq. Feet. " }}</td>
              <td>{{ stock?.currentQty + " Sq. Feet. " }}</td>
              <td *ngIf="!stock.note"></td>
                    <td *ngIf="stock.note" class="OverHide" (click)="op.toggle($event)" pTooltip="Click to See More"
                      tooltipPosition="bottom" tooltipStyleClass="tooltip">
                      {{ stock.note }}
                      <p-overlayPanel #op>
                        <div style="
                            width: 25rem;
                            display: flex;
                            flex-direction: column;
                            gap: 3;
                          ">
                          <div>
                            <h4>Notes</h4>
                            <p style="
                                word-wrap: break-word;
                                white-space: pre-wrap;
                              ">
                              {{ stock.note }}
                            </p>
                          </div>
                        </div>
                      </p-overlayPanel>
                    </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="8" class="text-center">
                No stock adjustments found.
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>

      <!-- Transfer GRID -->
      <p-tabPanel header="Stock Transfer">
        <p-table
          selectionMode="multiple"
          [value]="slabHistoryData?.transfers"
          styleClass="p-datatable-striped"
          [tableStyle]="{ 'min-width': '60rem' }"
          [paginator]="data?.length >= 5"
          [rows]="10"
          [rowsPerPageOptions]="[5, 10, 20]"
        >
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="createdOn">
                Transfer Date <p-sortIcon field="createdOn"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="createdOn"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="slab?.slabName">
                Slab Name <p-sortIcon field="slab?.slabName"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="slab?.slabName"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="fromWarehouse?.name">
                From-Warehouse
                <p-sortIcon field="fromWarehouse?.name"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="fromWarehouse?.name"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="toWarehouse?.name">
                To-Warehouse <p-sortIcon field="toWarehouse?.name"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="toWarehouse?.name"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="transferType">
                Transfer-Type <p-sortIcon field="transferType"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="transferType"
                  display="menu"
                ></p-columnFilter>
              </th>
              <th pSortableColumn="transferQty">
                Transfer Quantity <p-sortIcon field="transferQty"></p-sortIcon>
                <p-columnFilter
                  matchMode="contains"
                  hideOnClear="true"
                  type="text"
                  field="transferQty"
                  display="menu"
                ></p-columnFilter>
              </th>
              <!-- <th>Action</th> -->
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-stock>
            <tr>
              <td>{{ stock?.createdOn | date : "dd-MMM-yyyy" }}</td>
              <td>{{ stock?.slab?.slabName }}</td>
              <td>{{ stock?.fromWarehouse?.name }}</td>
              <td>{{ stock?.toWarehouse?.name }}</td>
              <td>{{ stock?.transferType }}</td>
              <td>{{ stock?.transferQty + " Sq. Feet. " }}</td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="6" class="text-center">No stock transfers found.</td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>


      <p-tabPanel header="Slab Expenses">
        <div class="card-body p-2">
          <!-- <p-table [value]="mergedExpenseData" styleClass="p-datatable-striped"
          [tableStyle]="{ 'min-width': '60rem' }">
          <ng-template pTemplate="header">
            <tr>
              <th>Date</th>
              <th>Slab Name</th>
              <th>Slab Number</th>
              <th>Expense Type</th>
              <th>Processor / Recipient</th>
              <th>Amount</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-expense>
            <tr>
              <td>{{ expense.date | date : "dd-MMM-yyyy" }}</td>
              <td>{{ expense.slab?.slabName }}</td>
              <td>{{ expense.slab?.slabNo }}</td>
              <td>{{ expense.type }}</td>
              <td>{{ expense.recipient || expense.processorName }}</td>
              <td>{{ expense.amount || expense.processingCost }}</td>
            
            </tr>
          </ng-template>
        </p-table> -->
        <p-table 
        [value]="mergedExpenseData" 
        [paginator]="true" 
        [rows]="10" 
        [sortMode]="'multiple'"
        styleClass="p-datatable-striped"
        [tableStyle]="{ 'min-width': '60rem' }">
      
        <!-- 🔹 Table Header with Sorting & Filtering -->
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="date">
              Date <p-sortIcon field="date"></p-sortIcon>
              <p-columnFilter matchMode="contains" field="date" display="menu"></p-columnFilter>
            </th>
            <th pSortableColumn="slab.slabName">
              Slab Name <p-sortIcon field="slab.slabName"></p-sortIcon>
              <p-columnFilter matchMode="contains" field="slab.slabName" display="menu"></p-columnFilter>
            </th>
            <th pSortableColumn="slab.slabNo">
              Slab Number <p-sortIcon field="slab.slabNo"></p-sortIcon>
              <p-columnFilter matchMode="contains" field="slab.slabNo" display="menu"></p-columnFilter>
            </th>
            <th pSortableColumn="type">
              Expense Type <p-sortIcon field="type"></p-sortIcon>
              <p-columnFilter matchMode="contains" field="type" display="menu"></p-columnFilter>
            </th>
            <th pSortableColumn="processorName">
              Processor / Recipient <p-sortIcon field="processorName"></p-sortIcon>
              <p-columnFilter matchMode="contains" field="processorName" display="menu"></p-columnFilter>
            </th>
            <th pSortableColumn="amount">
              Amount <p-sortIcon field="amount"></p-sortIcon>
              <p-columnFilter matchMode="contains" field="amount" display="menu"></p-columnFilter>
            </th>
          </tr>
        </ng-template>
      
        <!-- 🔹 Table Body -->
        <ng-template pTemplate="body" let-expense>
          <tr>
            <td>{{ expense.date | date : "dd-MMM-yyyy" }}</td>
            <td>{{ expense.slab?.slabName }}</td>
            <td>{{ expense.slab?.slabNo }}</td>
            <td>{{ expense.type }}</td>
            <td>{{ expense.recipient || expense.processorName }}</td>
            <td>{{ expense.amount || expense.processingCost }}</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="6" class="text-center">No expenses found.</td>
          </tr>
        </ng-template>
      </p-table>
      
      </div>
      </p-tabPanel>
    </p-tabView>
  </div>
</p-dialog>
<app-invoice-dialog *ngIf="showInvoiceDialog" [showInvoiceDialog]="showInvoiceDialog" [salesDataById]="salesDataById" [header]="header"
  [paymentDataListById]="paymentListData" (callbackModal)="callBackModalForInvoice()" (close)="closeForInvocie()"></app-invoice-dialog>