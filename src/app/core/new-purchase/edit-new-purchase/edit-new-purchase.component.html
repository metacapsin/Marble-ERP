<style>
    .p-stepper .p-stepper-panels {
        background: #ffffff;
        padding: 0%;
        color: #4b5563;
    }
</style>

<p-toast></p-toast>
<div class="page-wrapper">
    <div class="content">
        <!-- Page Header -->
        <div class="page-header">
            <div class="row">
                <div class="col-sm-12">
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a [routerLink]="routes.adminDashboard">Dashboard </a>
                        </li>
                        <li class="breadcrumb-item">
                            <i class="feather icon-chevron-right"></i>
                        </li>
                        <li class="breadcrumb-item active">Purchases List</li>
                        <li class="breadcrumb-item">
                            <i class="feather icon-chevron-right"></i>
                        </li>
                        <li class="breadcrumb-item active">Edit Purchase</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="page-header invoices-page-header">
            <div class="row align-items-center">
                <div class="col">
                    <ul class="breadcrumb invoices-breadcrumb">
                        <li class="breadcrumb-item invoices-breadcrumb-item">
                            <a [routerLink]="routes.listNewPurchase">
                                <i class="fa fa-chevron-left"></i> Back to Purchases List
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- /Page Header -->
        <div class="row">
            <div class="col-md-12">
                <div class="card invoices-add-card">
                    <div class="card-body">
                        <form [formGroup]="editNewPurchaseForm" (ngSubmit)="editNewPurchaseFormSubmit()">
                            <p-stepper [linear]="true">
                                <p-stepperPanel header="Product">
                                    <ng-template pTemplate="content" let-prevCallback="prevCallback"
                                        let-nextCallback="nextCallback" let-index="index">
                                        <div class="row">
                                            <div class="col-xl-4 col-md-4 col-sm-12 col-12">
                                                <div class="form-group local-forms">
                                                    <label for="lotsNo">Product Type<span
                                                            class="login-danger">*</span></label>
                                                    <p-dropdown [options]="lotsNoArray" [style]="{ width: '100%' }"
                                                        styleClass="" appendTo="body" optionLabel="name"
                                                        optionValue="_id" placeholder="Select Product Type"
                                                        [filter]="true" filterBy="name" [showClear]="true"
                                                        (onChange)="lotType($event.value)"
                                                        formControlName="purchaseType">
                                                    </p-dropdown>
                                                    <div *ngIf="
                                                        editNewPurchaseForm
                                                        .get('purchaseType')
                                                        ?.hasError('required') &&
                                                        editNewPurchaseForm.get('purchaseType')?.touched
                                                        ">
                                                        <span class="login-danger">Field is required.
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-4">
                                                <div class="form-group local-forms">
                                                    <label for="vehicleNo">Vehicle Number</label>
                                                    <input class="form-control" type="text"
                                                        (input)="onVehicleInput($event)"
                                                        placeholder="Enter Vehicle Number"
                                                        formControlName="vehicleNo" />
                                                    <div *ngIf="setValidations('vehicleNo')">
                                                        <span class="login-danger">Invalid vehicle number format. Please
                                                            correct it.</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-4">
                                                <div class="form-group local-forms">
                                                    <label for="warehouseDetails">Warehouse<span
                                                            class="login-danger">*</span></label>
                                                    <p-dropdown [options]="wareHousedataListsEditArray" appendTo="body"
                                                        optionLabel="name" optionValue="_id"
                                                        placeholder="Select Warehouse" formControlName="warehouseDetails"
                                                        [style]="{ width: '100%' }" [filter]="true" filterBy="name"
                                                        [showClear]="true">
                                                    </p-dropdown>
                                                    <div *ngIf="setValidations('warehouseDetails')">
                                                        <span class="login-danger">Field is required.</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div *ngIf="lotTypeValue === 'slab'">
                                            <app-add-slab-purchase [editSlabValues]="editSlabValues"
                                                [addSlabdisableBtn]="!editNewPurchaseForm.get('warehouseDetails')?.value"
                                                class="col-12" [tab]="'product'"></app-add-slab-purchase>
                                        </div>
                                        <div *ngIf="lotTypeValue === 'lot'">
                                            <!-- <app-add-lot class="col-12"></app-add-lot> -->
                                        </div>
                                        <div class="row">
                                            <div class="col text-end">
                                                <button class="btn btn-primary"
                                                    [disabled]="!editNewPurchaseForm.get('purchaseType')?.value || !editNewPurchaseForm.get('warehouseDetails')?.value || slabDetailsLength == 0"
                                                    (click)="nextStep(nextCallback, 'first')">
                                                    Next <i class="fa-solid fa-arrow-right"></i>
                                                </button>
                                            </div>
                                        </div>

                                    </ng-template>

                                </p-stepperPanel>
                                <p-stepperPanel header="Purchase">
                                    <ng-template pTemplate="content" let-prevCallback="prevCallback"
                                        let-nextCallback="nextCallback" let-index="index">
                                        <!-- Purchase basic Information -->
                                        <div class="row">
                                            <div class="col-xl-4 col-md-4 col-sm-12 col-12">
                                                <div class="form-group local-forms">
                                                    <label for="invoiceNumber">Invoice Number<span
                                                            class="login-danger"></span></label>
                                                    <input type="text" class="form-control"
                                                        placeholder="Enter Invoice Number"
                                                        formControlName="invoiceNumber" />
                                                    <span
                                                        *ngIf="editNewPurchaseForm.get('invoiceNumber')?.value.length === 0"
                                                        style="color: #97704f; font-size: 12px">Leave it blank to
                                                        generate
                                                        automatically</span>
                                                    <div *ngIf="
                                                            editNewPurchaseForm.get('invoiceNumber')?.hasError('pattern') &&
                                                            editNewPurchaseForm.get('invoiceNumber')?.touched
                                                        ">
                                                        <span class="login-danger">Please Enter Valid Invoice Number.
                                                        </span>
                                                    </div>

                                                </div>
                                            </div>
                                            <div class="col-xl-4 col-md-4 col-sm-12 col-12">
                                                <div class="form-group local-forms">
                                                    <label for="purchaseDate">Purchase Date <span
                                                            class="login-danger">*</span></label>
                                                    <p-calendar [maxDate]="maxDate" dataType="string" appendTo="body"
                                                        dateFormat="dd/mm/yy" formControlName="purchaseDate"
                                                        placeholder="DD/MM/YYYY" [styleClass]="'col-12'"></p-calendar>
                                                    <div *ngIf="
                                                            editNewPurchaseForm
                                                                .get('purchaseDate')
                                                                ?.hasError('required') &&
                                                            editNewPurchaseForm.get('purchaseDate')
                                                                ?.touched
                                                            ">
                                                        <span class="login-danger">Field is required.
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xl-4 col-md-4 col-sm-12 col-12">
                                                <div class="form-group local-forms">
                                                    <label for="supplier">Supplier Name<span
                                                            class="login-danger">*</span></label>
                                                    <p-dropdown [style]="{ width: '100%' }"
                                                        placeholder="Select Supplier" [options]="SupplierLists"
                                                        formControlName="supplier" optionLabel="name" optionValue="_id"
                                                        display="chip" [showClear]="true"></p-dropdown>

                                                    <div *ngIf="
                                                        editNewPurchaseForm
                                                            .get('supplier')
                                                            ?.hasError('required') &&
                                                        editNewPurchaseForm.get('supplier')?.touched
                                                        ">
                                                        <span class="login-danger">Field is required.
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- <div class="col-xl-4 col-md-4 col-sm-12 col-12">
                        <div class="form-group local-forms">
                          <label for="customer">Taxable Amount</label>
                            <input type="num  ber" formControlName="taxableAmount" (change)="calculateTotalAmount()"
                              class="form-control" placeholder="Enter Taxable Amount" />
                        </div>
                      </div>

                      <div class="col-xl-4 col-md-4 col-sm-12 col-12">
                        <div class="form-group local-forms">
                          <label for="customer">Tax/GST</label>
                          <p-inputGroup>
                            <p-multiSelect [style]="{ width: '100%' }" placeholder="Select Tax" [options]="orderTaxList"
                              appendTo="body" formControlName="ItemTax" optionLabel="orderTaxName" optionValue="orderNamevalue"
                              display="chip" (onChange)="calculateTotalAmount()" [maxSelectedLabels]="1"></p-multiSelect>
                          </p-inputGroup>
                          <div *ngIf="
                editNewPurchaseForm.hasError('taxRequired') && 
                editNewPurchaseForm.get('taxableAmount')?.touched
              ">
              <span class="login-danger">Please apply tax.</span>
            </div>
                          <div *ngIf=" (editNewPurchaseForm.get('taxableAmount')?.hasError('min') &&
                          editNewPurchaseForm.get('taxableAmount')?.touched) ||
                        (editNewPurchaseForm.get('taxableAmount')?.hasError('max') &&
                          editNewPurchaseForm.get('taxableAmount')?.touched)">
                            <span class="login-danger">Taxable Amount cannot be greater than Lot Weight * Price/ton
                              ({{rawCosting}}).</span>
                          </div>
                          <span *ngIf="
                              editNewPurchaseForm.get('taxable')?.value
                            " style="color: #97704f; font-size: 12px">
                            Tax Applied Amount:
                            {{ editNewPurchaseForm.get('taxable')?.value | indianCurrency }}
                          </span>
                        </div>
                      </div>

                      <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                          <label for="nonTaxableAmount">Non-Taxable Amount </label>
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">₹</span>
                            </div>
                            <input type="number" formControlName="nonTaxableAmount" (change)="calculateTotalAmount()"
                              class="form-control" placeholder="Enter Non-Taxable Amount" />
                            <div class="input-group">
                              <div class="input-group-prepend">
                                <span class="input-group-text">₹</span>
                              </div>
                              <span class="form-control">{{
                                editNewPurchaseForm.get("nonTaxable")?.value | indianCurrency
                                }}</span>
                            </div>
                          </div>
                          <div *ngIf="(editNewPurchaseForm.get('nonTaxableAmount')?.hasError('min') &&
                          editNewPurchaseForm.get('nonTaxableAmount')?.touched) ||
                        (editNewPurchaseForm.get('nonTaxableAmount')?.hasError('max') &&
                          editNewPurchaseForm.get('nonTaxableAmount')?.touched)">
                            <span class="login-danger">Non-Taxable Amount cannot be greater than Lot Weight * Price/ton
                              ({{editNewPurchaseForm.get('rawCosting')?.value | indianCurrency}}).</span>
                          </div>
                        </div>
                      </div>

                      <div class="col-xl-4 col-md-4 col-sm-12 col-12">
                        <div class="form-group local-forms">
                          <label for="paidToSupplierPurchaseCost">Purchase Cost ( Paid to Supplier )
                            <span class="login-danger">*</span></label>
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">₹</span>
                            </div>
                            <span class="form-control">{{
                              editNewPurchaseForm.get("paidToSupplierPurchaseCost")?.value | indianCurrency
                              }}</span>
                          </div>
                          <span *ngIf="
                              editNewPurchaseForm.get('taxable')?.value  > editNewPurchaseForm.get('taxableAmount')?.value &&
                              editNewPurchaseForm.get('taxable')?.value  != 0
                            " style="color: #97704f; font-size: 12px">
                            Tax Applied Amount:
                            {{ editNewPurchaseForm.get('taxable')?.value | indianCurrency }}
                            + Non Taxable Amount :
                            {{
                            editNewPurchaseForm.get("nonTaxableAmount")?.value | indianCurrency
                            }}
                            <span *ngIf="editNewPurchaseForm.get('purchaseDiscount')?.value > 0">
                              - Discount :
                              {{
                              editNewPurchaseForm.get("purchaseDiscount")?.value | indianCurrency
                              }}
                            </span>
                          </span>
                        </div>
                      </div>
            
                      <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                          <label for="purchaseDiscount">Discount </label>
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">₹</span>
                            </div>
                            <input class="form-control" type="number" placeholder="Enter Discount" (change)="calculateTotalAmount()"
                              formControlName="purchaseDiscount" />
                          </div>
                          <div *ngIf="
                              (editNewPurchaseForm.get('purchaseDiscount')?.hasError('min') &&
                                editNewPurchaseForm.get('purchaseDiscount')?.touched) ||
                              (editNewPurchaseForm.get('purchaseDiscount')?.hasError('max') &&
                                editNewPurchaseForm.get('purchaseDiscount')?.touched)
                            ">
                            <span class="login-danger">Input Must be between 1 to {{maxPurchaseAmount}}.</span>
                          </div>
                        </div>
                      </div>

                      <div class="col-xl-6 col-md-6 col-sm-12 col-12">
                        <div class="form-group local-forms">
                          <label for="lotsNo">Product Type<span class="login-danger">*</span></label>
                          <p-dropdown [options]="lotsNoArray" [style]="{ width: '100%' }" styleClass="" appendTo="body"
                            optionLabel="name" optionValue="_id" placeholder="Select Product Type" [filter]="true"
                            filterBy="name" [showClear]="true" (onChange)="lotType($event.value)"
                            formControlName="purchaseType">
                          </p-dropdown>
                          <div *ngIf="
                            editNewPurchaseForm
                              .get('purchaseType')
                              ?.hasError('required') &&
                            editNewPurchaseForm.get('purchaseType')?.touched
                          ">
                            <span class="login-danger">Field is required.
                            </span>
                          </div>
                        </div>
                      </div> -->
                                        </div>

                                        <!-- <p-accordion  [activeIndex]="0">
                      <p-accordionTab >
                        <ng-template pTemplate="header">
                          <div class="d-flex justify-content-between align-items-center w-100">
                            <span class="font-bold">Expenses</span>
                            <button pButton type="button" icon="fa fa-plus" class="p-button-text p-0" (click)="addExpense($event)"></button>
                          </div>
                        </ng-template>

                        <div class="row">
                          <div class="expenses-content" *ngIf="expensesExpanded">
                            <table class="expenses-table w-100">
                              <thead>
                                  <tr>
                                    <th>Type</th>
                                    <th>Payment</th>
                                    <th>Paid by:</th>
                                    <th></th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr *ngFor="let expense of expenses; let i = index">
                                    <td>
                                      <p-dropdown 
                                      [options]="expenseTypeOptions" 
                                      [(ngModel)]="expense.type"
                                      [ngModelOptions]="{standalone: true}" 
                                      placeholder="Select Type" 
                                      optionLabel="name"
                                      optionValue="value"
                                      styleClass="w-100" 
                                      appendTo="body">
                                    </p-dropdown>
                                    
                                    </td>
                                    <td>
                                      <div class="input-with-icon">
                                        <input type="text" pInputText [(ngModel)]="expense.payment" 
                                          [ngModelOptions]="{standalone: true}" class="form-control">
                                        <span class="input-icon">₹</span>
                                      </div>
                                    </td>
                                    <td>
                                      <div class="radio-group">
                                        <div class="d-flex align-items-center gap-3">
                                          <p-radioButton name="paidBy_{{i}}" value="self" 
                                            [(ngModel)]="expense.paidBy" [ngModelOptions]="{standalone: true}"></p-radioButton>
                                          <label class="me-3">Self</label>
                                          <p-radioButton name="paidBy_{{i}}" value="supplier" 
                                            [(ngModel)]="expense.paidBy" [ngModelOptions]="{standalone: true}"></p-radioButton>
                                          <label>Supplier</label>
                                        </div>
                                      </div>
                                    </td>
                                    <td class="text-center">
                                      <button pButton type="button" icon="fa fa-trash" 
                                        class="p-button-text p-button-danger" 
                                        (click)="removeExpense(i)"></button>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </div>
                      </p-accordionTab>
                  </p-accordion> -->


                                        <!-- lot Information -->
                                        <div *ngIf="lotTypeValue === 'lot'">
                                            <!-- <app-add-lot class="col-12"></app-add-lot> -->
                                        </div>
                                        <div *ngIf="lotTypeValue === 'slab'">
                                            <app-add-slab-purchase (nextBtnDisabled)="onnextBtnDisabled($event)"
                                                class="col-12" [tab]="'purchase'"></app-add-slab-purchase>
                                        </div>
                                        <!-- SLAB Information -->
                                        <div class="d-flex justify-content-between align-items-center pt-4">
                                            <!-- Left aligned Back button -->
                                            <button type="button" class="btn btn-primary"
                                                (click)="backStep(prevCallback, 'Slab')">
                                                <i class="fa-solid fa-arrow-left"></i> Back
                                            </button>

                                            <!-- Right aligned Next button -->
                                            <ng-container *ngIf="lotTypeValue === 'Lot'">
                                                <!-- [disabled]="!child?.blocksDetails?.length || !editNewPurchaseForm?.valid || !child?.lotAddForm?.valid" -->
                                                <button
                                                    [disabled]="!child?.blocksDetails?.length || !editNewPurchaseForm?.valid"
                                                    class="btn btn-primary" (click)="nextStep(nextCallback, 'first')"
                                                    [disabled]="!editNewPurchaseForm.get('purchaseDate')?.value || !editNewPurchaseForm.get('supplier')?.value || addSlabData.get('taxableAmount')?.touched && addSlabData.get('taxApplied')?.value > 0">
                                                    Next <i class="fa-solid fa-arrow-right"></i>
                                                </button>
                                            </ng-container>

                                            <ng-container *ngIf="lotTypeValue === 'slab'">
                                                <button class="btn btn-primary"
                                                    (click)="nextStep(nextCallback, 'first')"
                                                    [disabled]="!editNewPurchaseForm.get('purchaseDate')?.value || !editNewPurchaseForm.get('supplier')?.value || (taxableAmount > 0 && itemTax.length === 0)">
                                                    Next <i class="fa-solid fa-arrow-right"></i>
                                                </button>
                                            </ng-container>
                                        </div>

                                    </ng-template>
                                </p-stepperPanel>
                                <p-stepperPanel header="Summary">
                                    <ng-template pTemplate="content" let-prevCallback="prevCallback"
                                        let-nextCallback="nextCallback" let-index="index">
                                        <!-- ---------------To Show Information--------------------------- -->
                                        <div class="card">
                                            <div class="card-body">
                                                <h3>Purchase Information</h3>
                                                <div class="row practice-card">
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Invoice Number
                                                            </h5>
                                                            <!-- <div class="col-lg-6 col-md-6 col-xl-6"> -->
                                                            <div class="col-lg-6 col-md-6 col-xl-6"
                                                                *ngIf="editNewPurchaseForm.get('invoiceNumber').value ; else noValueTemplate">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ editNewPurchaseForm.get('invoiceNumber').value }}
                                                                </p>
                                                            </div>

                                                            <ng-template #noValueTemplate>
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    It will be auto-generated or you can go back to add
                                                                    it manually.
                                                                </p>
                                                            </ng-template>
                                                        </div>
                                                        <!-- </div> -->
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Purchase Date
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ editNewPurchaseForm.get("purchaseDate").value |
                                                                    dateTransform | date: 'd MMM yyyy'
                                                                    }}

                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Supplier
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ editNewPurchaseForm.get("supplier").value.name }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Purchase Cost
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    ₹
                                                                    {{
                                                                    editNewPurchaseForm.get("paidToSupplierPurchaseCost")?.value
                                                                    ?
                                                                    (editNewPurchaseForm.get("paidToSupplierPurchaseCost")?.value
                                                                    | indianCurrency) :
                                                                    ' -- ' }}
                                                                </p>
                                                                <span style="font-size: 12px;"
                                                                    *ngIf="editNewPurchaseForm.get('nonTaxable')?.value">Non-Taxable
                                                                    Amount {{ '₹ ' +
                                                                    (editNewPurchaseForm.get('nonTaxable')?.value |
                                                                    indianCurrency) }}</span>
                                                                <br />
                                                                <span style="font-size: 12px;"
                                                                    *ngIf="editNewPurchaseForm.get('taxable')?.value">Taxable
                                                                    Amount {{ '₹ ' +
                                                                    (editNewPurchaseForm.get('taxable')?.value |
                                                                    indianCurrency) }}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card" *ngIf="lotTypeValue === 'lot'">
                                            <div class="card-body">
                                                <h3>Block Information</h3>
                                                <div class="row practice-card" *ngIf="ItemDetails">
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Lot Number
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ ItemDetails?.lotNo ? ItemDetails?.lotNo : ' - '
                                                                    }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Lot Name
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ ItemDetails?.lotName ? ItemDetails?.lotName : ' -' }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Vehicle Number
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ ItemDetails?.vehicleNo ? ItemDetails?.vehicleNo :
                                                                    ' - ' }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Warehouse
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ ItemDetails?.warehouseDetails.name ?
                                                                    ItemDetails?.warehouseDetails.name : ' - ' }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Category
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ ItemDetails?.categoryDetail.name ?
                                                                    ItemDetails?.categoryDetail.name : ' - ' }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Sub Category
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ ItemDetails?.subCategoryDetail.name ?
                                                                    ItemDetails?.subCategoryDetail.name : ' - '
                                                                    }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Lot Weight (Ton)
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ ItemDetails?.lotWeight ? ItemDetails?.lotWeight :
                                                                    ' - '}}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Price / Ton
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    ₹ {{ ItemDetails?.pricePerTon |indianCurrency}}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Purchase Cost ( Paid to Supplier )
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    ₹ {{ ItemDetails?.paidToSupplierLotCost
                                                                    |indianCurrency}}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Discount
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    ₹ {{ ItemDetails?.purchaseDiscount |indianCurrency}}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Transportation Charge / Ton
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    ₹ {{ ItemDetails?.transportationCharge
                                                                    |indianCurrency }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Royalty ( Other Charge )
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    ₹ {{ ItemDetails?.royaltyCharge | indianCurrency}}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- ---------------------block-------------- -->
                                            <div class="row p-2" *ngIf="ItemDetails?.blockDetails?.length > 0">
                                                <div class="col-sm-12">
                                                    <div class="card-body"
                                                        style="border-top: 1px solid rgb(189 189 189);">
                                                        <!-- <div class="card-body"> -->
                                                        <div class="page-table-header mb-2">
                                                            <div class="d-flex m-b-10"
                                                                style="justify-content: space-between">
                                                                <h3>Block List</h3>
                                                            </div>

                                                            <div class="row practice-card">
                                                                <div class="col-xl-6 col-lg-6 col-sm-6 d-none">
                                                                    <div class="form-group row mb-2">
                                                                        <h5
                                                                            class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                            Average Size / Ton
                                                                        </h5>
                                                                        <div class="col-lg-6 col-md-6 col-xl-6">
                                                                            <p
                                                                                class="col-lg-6 col-form-label heading-bold">
                                                                                {{ ItemDetails.averageWeight?.toFixed(3)
                                                                                }}
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-xl-6 col-lg-6 col-sm-6">
                                                                    <div class="form-group row mb-2">
                                                                        <h5
                                                                            class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                            Purchase Row Cost
                                                                        </h5>
                                                                        <div class="col-lg-6 col-md-6 col-xl-6">
                                                                            <p
                                                                                class="col-lg-6 col-form-label heading-bold">
                                                                                ₹
                                                                                {{
                                                                                ItemDetails.lotRowCost | indianCurrency
                                                                                }}
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-xl-6 col-lg-6 col-sm-6">
                                                                    <div class="form-group row mb-2">
                                                                        <h5
                                                                            class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                            Transportation Charge / Ton
                                                                        </h5>
                                                                        <div class="col-lg-6 col-md-6 col-xl-6">
                                                                            <p
                                                                                class="col-lg-6 col-form-label heading-bold">
                                                                                ₹
                                                                                {{
                                                                                ItemDetails.averageTransport |
                                                                                indianCurrency
                                                                                }}
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-xl-6 col-lg-6 col-sm-6">
                                                                    <div class="form-group row mb-2">
                                                                        <h5
                                                                            class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                            Royalty Charge / Ton
                                                                        </h5>
                                                                        <div class="col-lg-6 col-md-6 col-xl-6">
                                                                            <p
                                                                                class="col-lg-6 col-form-label heading-bold">
                                                                                ₹
                                                                                {{ ItemDetails.averageRoyaltyNumber |
                                                                                indianCurrency }}
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row p-2">
                                                            <p-accordion [activeIndex]="0" [multiple]="true">
                                                                <p-accordionTab
                                                                    *ngFor="let data of ItemDetails.blockDetails; let i = index">
                                                                    <ng-template pTemplate="header">
                                                                        <span
                                                                            class="d-flex justify-content-between w-full">
                                                                            <span class="font-bold white-space-nowrap">
                                                                                Block Number: {{ data.blockNo }} ({{
                                                                                data.weightPerBlock?.toFixed(3)
                                                                                }}
                                                                                Ton)
                                                                            </span>
                                                                        </span>
                                                                    </ng-template>
                                                                    <div class="row">
                                                                        <div class="col-sm-12">
                                                                            <div class="card card-table show-entire">
                                                                                <div class="page-table-header mb-2 m-3">
                                                                                    <div class="row practice-card">
                                                                                        <div
                                                                                            class="col-xl-6 col-lg-6 col-sm-12">
                                                                                            <div
                                                                                                class="form-group row mb-2">
                                                                                                <h5
                                                                                                    class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                                                                                                    Length (Inch)
                                                                                                </h5>
                                                                                                <div
                                                                                                    class="col-lg-9 col-md-9 col-xl-9">
                                                                                                    <p
                                                                                                        class="col-form-label">
                                                                                                        {{ data.length
                                                                                                        }}
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div
                                                                                                class="form-group row mb-2">
                                                                                                <h5
                                                                                                    class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                                                                                                    Width (Inch)
                                                                                                </h5>
                                                                                                <div
                                                                                                    class="col-lg-9 col-md-9 col-xl-9">
                                                                                                    <p
                                                                                                        class="col-form-label">
                                                                                                        {{ data.width }}
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div
                                                                                                class="form-group row mb-2">
                                                                                                <h5
                                                                                                    class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                                                                                                    Height (Inch)
                                                                                                </h5>
                                                                                                <div
                                                                                                    class="col-lg-9 col-md-9 col-xl-9">
                                                                                                    <p
                                                                                                        class="col-lg-9 col-form-label">
                                                                                                        {{ data.height
                                                                                                        }}
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div
                                                                                                class="form-group row mb-2">
                                                                                                <h5
                                                                                                    class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                                                                                                    Block Size
                                                                                                    (Inch<sup>3</sup>)
                                                                                                </h5>
                                                                                                <div
                                                                                                    class="col-lg-9 col-md-9 col-xl-9">
                                                                                                    <p
                                                                                                        class="col-form-label">
                                                                                                        {{
                                                                                                        data.totalArea
                                                                                                        }}
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div
                                                                                                class="form-group row mb-2">
                                                                                                <h5
                                                                                                    class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                                                                                                    Weight (Ton)
                                                                                                </h5>
                                                                                                <div
                                                                                                    class="col-lg-9 col-md-9 col-xl-9">
                                                                                                    <p
                                                                                                        class="col-form-label">
                                                                                                        {{
                                                                                                        data.weightPerBlock?.toFixed(3)
                                                                                                        }}
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div
                                                                                            class="col-xl-6 col-lg-6 col-sm-12">
                                                                                            <div *ngIf="data?.blockProcessor?.name"
                                                                                                class="form-group row mb-2">
                                                                                                <h5
                                                                                                    class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                                                                                                    Block Processor
                                                                                                </h5>
                                                                                                <div
                                                                                                    class="col-lg-9 col-md-9 col-xl-9">
                                                                                                    <p
                                                                                                        class="col-form-label">
                                                                                                        {{
                                                                                                        data.blockProcessor.name
                                                                                                        ?
                                                                                                        data.blockProcessor.name
                                                                                                        : ' - ' }}
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div
                                                                                                class="form-group row mb-2">
                                                                                                <h5
                                                                                                    class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                                                                                                    Raw Costing
                                                                                                </h5>
                                                                                                <div
                                                                                                    class="col-lg-9 col-md-9 col-xl-9">
                                                                                                    <p
                                                                                                        class="col-form-label">
                                                                                                        ₹ {{
                                                                                                        data.rawCosting
                                                                                                        | indianCurrency
                                                                                                        }}
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div
                                                                                                class="form-group row mb-2">
                                                                                                <h5
                                                                                                    class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                                                                                                    Transportation
                                                                                                    Costing
                                                                                                </h5>
                                                                                                <div
                                                                                                    class="col-lg-9 col-md-9 col-xl-9">
                                                                                                    <p
                                                                                                        class="col-form-label">
                                                                                                        ₹
                                                                                                        {{
                                                                                                        data.transportationCosting
                                                                                                        | indianCurrency
                                                                                                        }}
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div
                                                                                                class="form-group row mb-2">
                                                                                                <h5
                                                                                                    class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                                                                                                    Royalty Costing
                                                                                                </h5>
                                                                                                <div
                                                                                                    class="col-lg-9 col-md-9 col-xl-9">
                                                                                                    <p
                                                                                                        class="col-form-label">
                                                                                                        ₹
                                                                                                        {{
                                                                                                        data.royaltyCosting
                                                                                                        | indianCurrency
                                                                                                        }}
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div
                                                                                                class="form-group row mb-2">
                                                                                                <h5
                                                                                                    class="col-lg-3 col-md-3 col-xl-3 col-form-label">
                                                                                                    Total Costing
                                                                                                </h5>
                                                                                                <div
                                                                                                    class="col-lg-9 col-md-9 col-xl-9">
                                                                                                    <p
                                                                                                        class="col-form-label">
                                                                                                        ₹ {{
                                                                                                        data.totalCosting
                                                                                                        | indianCurrency
                                                                                                        }}
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </p-accordionTab>
                                                            </p-accordion>
                                                        </div>
                                                        <!-- </div> -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card" *ngIf="lotTypeValue === 'slab'">
                                            <div class="card-body">
                                                <h3>{{ editNewPurchaseForm.get("purchaseType").value }} Information</h3>
                                                <div class="row practice-card">
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Warehouse Name
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ getSelectedWarehouseName() }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-lg-6 col-sm-6">
                                                        <div class="form-group row mb-2">
                                                            <h5
                                                                class="col-lg-6 col-md-6 col-xl-6 col-form-label heading-bold">
                                                                Vehicle No
                                                            </h5>
                                                            <div class="col-lg-6 col-md-6 col-xl-6">
                                                                <p class="col-lg-6 col-form-label heading-bold">
                                                                    {{ editNewPurchaseForm.get("vehicleNo")?.value ?? '
                                                                    -- ' }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row p-2">
                                                <p-accordion [activeIndex]="0" [multiple]="true">
                                                    <p-accordionTab *ngFor="let data of SlabItemDetails?.slabDetails; let i = index">
                                                        <ng-template pTemplate="header">
                                                            <span class="d-flex justify-content-between w-full">
                                                                <span class="font-bold white-space-nowrap">
                                                                    Slab Number: {{ data?.slabNo ?? ' -- '}}
                                                                </span>
                                                            </span>
                                                        </ng-template>
                                            
                                                        <div class="row">
                                                            <div class="col-sm-12">
                                                                <div class="card card-table show-entire">
                                                                    <div class="page-table-header mb-2 m-3">
                                                                        <div class="row practice-card">
                                                                            <div class="col-xl-6 col-lg-6 col-sm-12">
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Slab Name
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            {{ data?.slabName ?? ' -- '?? '--' }}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Length ({{data.unitsType == 'square_feet' ? 'Inch' :
                                                                                        'Meter'}})
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            {{ data?.length ?? ' -- '}}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Width ({{data.unitsType == 'square_feet' ? 'Inch' :
                                                                                        'Meter'}})
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">{{ data?.width ?? ' -- '}}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Thickness
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            {{ data?.thickness ?? ' -- '}}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Number of Pieces
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            {{ data?.noOfPieces ?? ' -- '}}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Finishes
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            {{ data?.finishes.name ?? ' -- ' }}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Total Amount
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            ₹ {{ data?.totalCosting ?? ' -- '}}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                            
                                                                            <div class="col-xl-6 col-lg-6 col-sm-12">
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Quantity / Sq. Feet
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            {{ data?.totalSQFT ? (data.totalSQFT |
                                                                                            number:'1.2-2') : '--' }}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Quantity / Sq. Meter
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            {{ data?.totalSQMT ? (data.totalSQMT |
                                                                                            number:'1.2-2') : '--' }}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Rate / Sq. Feet
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            ₹ {{ data?.ratePerSqFeet ?? ' -- '}}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Rate / Sq. Meter
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            ₹ {{ data?.ratePerSqMeter ?? ' -- '}}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Cost Per SQFT
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            ₹ {{ data?.costPerSQFT ?? ' -- '}}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group row mb-2">
                                                                                    <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                                        Cost Per SQMT
                                                                                    </h5>
                                                                                    <div class="col-lg-8 col-md-8 col-xl-8">
                                                                                        <p class="col-form-label">
                                                                                            ₹ {{ data?.costPerSQMT ?? ' -- '}}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </p-accordionTab>
                                                </p-accordion>
                                            </div>

                                            <form *ngIf="expenses.controls[0].get('payment')?.value != ''"
                                                [formGroup]="expensesForm">
                                                <p-accordion [activeIndex]="0">
                                                    <p-accordionTab>
                                                        <ng-template pTemplate="header">
                                                            <div
                                                                class="d-flex justify-content-between align-items-center w-100">
                                                                <span class="font-bold">Expenses</span>
                                                            </div>
                                                        </ng-template>

                                                        <div class="row">
                                                            <table class="table table-bordered"
                                                                formArrayName="expenses">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Type</th>
                                                                        <th>Payment</th>
                                                                        <th>Tax</th>
                                                                        <th>Paid By</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr *ngFor="let expense of expenses.controls; let i = index"
                                                                        [formGroupName]="i">
                                                                        <td>
                                                                            {{ getExpenseTypeName(expense.get('type')?.value) }}
                                                                        </td>
                                                                        <td>{{ expense.get('payment')?.value }}</td>
                                                                        <td class="d-flex gap-2">
                                                                            <p>{{expense.get('ItemTax')?.value?.taxRate}} %</p> 
                                                                            <p>{{getTaxType(expense.get('state_tax')?.value)}}</p> 
                                                                        </td>
                                                                        <td>
                                                                            {{ capitalizeFirstLetter(expense.get('paidBy')?.value) }}
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </p-accordionTab>
                                                </p-accordion>
                                            </form>


                                        </div>

                                        <div class="row">
                                            <div class="col-lg-7 col-md-6">
                                                <div class="invoice-fields">
                                                    <h4 class="field-title">More Fields</h4>
                                                </div>
                                                <!-- First Collapsible Panel -->
                                                <div class="invoice-faq">
                                                    <div class="panel-group" id="headingTwo" role="tablist"
                                                        aria-multiselectable="true">
                                                        <div class="faq-tab">
                                                            <div class="panel panel-default">
                                                                <div class="panel-heading" role="tab" id="headingTwo">
                                                                    <p class="panel-title">
                                                                        <a class="collapsed" data-bs-toggle="collapse"
                                                                            data-bs-parent="#headingTwo"
                                                                            href="#collapseNotes" aria-expanded="false"
                                                                            aria-controls="collapseNotes">
                                                                            <i class="fas fa-plus-circle me-1"></i> Add
                                                                            Notes
                                                                        </a>
                                                                    </p>
                                                                </div>
                                                                <div id="collapseNotes" class="panel-collapse collapse"
                                                                    role="tabpanel" aria-labelledby="headingTwo"
                                                                    data-bs-parent="#headingTwo">
                                                                    <div class="panel-body">
                                                                        <textarea class="form-control"
                                                                            formControlName="purchaseNotes"></textarea>
                                                                        <div
                                                                            *ngIf="editNewPurchaseForm.get('purchaseNotes')?.hasError('pattern')  && editNewPurchaseForm.get('purchaseNotes')?.touched">
                                                                            <span class="login-danger">Input must be
                                                                                between 3 to
                                                                                500 characters.</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                                <div class="invoice-faq">
                                                    <div class="panel-group" id="attachFile" role="tablist"
                                                        aria-multiselectable="true">
                                                        <div class="faq-tab">
                                                            <div class="panel panel-default">
                                                                <div class="panel-heading" role="tab" id="attachFile">
                                                                    <p class="panel-title">
                                                                        <a data-bs-toggle="collapse"
                                                                            data-bs-parent="#attachFile"
                                                                            href="#collapseattachFile"
                                                                            aria-expanded="true"
                                                                            aria-controls="collapseattachFile">
                                                                            <i class="fas fa-plus-circle me-1"></i>
                                                                            Attach File
                                                                        </a>
                                                                    </p>
                                                                </div>
                                                                <div id="collapseattachFile" class="panel-collapse"
                                                                    role="tabpanel" aria-labelledby="attachFile"
                                                                    data-bs-parent="#attachFile">
                                                                    <div class="panel-body">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-5 col-md-6">
                                                <div class="invoice-total-card">
                                                    <h4 class="invoice-total-title">Summary</h4>
                                                    <div class="invoice-total-box">
                                                        <div class="invoice-total-inner" *ngIf="lotTypeValue === 'Lot'">
                                                            <p *ngIf="ItemDetails?.lotWeight">
                                                                Lot Weight ( Ton )<span>
                                                                    {{ ItemDetails?.lotWeight}}
                                                                </span>
                                                            </p>
                                                            <p *ngIf="ItemDetails?.lotWeight === undefined">
                                                                Lot Weight ( Ton )<span>

                                                                </span>
                                                            </p>
                                                            <p *ngIf="ItemDetails?.pricePerTon">
                                                                Price / Ton<span>
                                                                    {{ ItemDetails?.pricePerTon |indianCurrency}}
                                                                </span>
                                                            </p>
                                                            <p *ngIf="ItemDetails?.pricePerTon  === undefined">
                                                                Price / Ton<span>
                                                                </span>
                                                            </p>
                                                            <p *ngIf="ItemDetails?.transportationCharge === undefined">
                                                                Transport Charges / Ton<span> </span>
                                                            </p>
                                                            <p *ngIf="ItemDetails?.transportationCharge">
                                                                Transport Charges / Ton<span>
                                                                    ₹ {{ ItemDetails?.transportationCharge
                                                                    |indianCurrency }}

                                                                </span>
                                                            </p>
                                                            <p
                                                                *ngIf="editNewPurchaseForm.get('paidToSupplierPurchaseCost')?.value">
                                                                Purchase Cost ( Paid To Supplier)
                                                                <span>₹
                                                                    {{
                                                                    editNewPurchaseForm.get("paidToSupplierPurchaseCost")?.value
                                                                    |indianCurrency
                                                                    }}
                                                                </span>
                                                            </p>
                                                        </div>
                                                        <!-- ---------------slab--------------------------- -->
                                                        <div class="invoice-total-inner"
                                                            *ngIf="lotTypeValue === 'slab'">
                                                            <p *ngIf="editNewPurchaseForm.get('totalSQFT')?.value">
                                                                Total Square Feet<span>
                                                                    {{ editNewPurchaseForm.get('totalSQFT').value |
                                                                    indianCurrency }}

                                                                </span>
                                                            </p>
                                                            <p
                                                                *ngIf="editNewPurchaseForm.get('transportationCharges')?.value">
                                                                Transport Charges<span>
                                                                    ₹ {{
                                                                    editNewPurchaseForm.get('transportationCharges').value
                                                                    | indianCurrency}}
                                                                </span>
                                                            </p>
                                                            <p *ngIf="editNewPurchaseForm.get('otherCharges')?.value">
                                                                Other Charges
                                                                <span>
                                                                    ₹ {{ editNewPurchaseForm.get('otherCharges').value |
                                                                    indianCurrency}}
                                                                </span>
                                                            </p>
                                                            <p>
                                                                Purchase Cost ( Paid To Supplier)
                                                                <span>₹
                                                                    {{
                                                                    editNewPurchaseForm.get("paidToSupplierPurchaseCost")?.value
                                                                    ? (
                                                                    editNewPurchaseForm.get("paidToSupplierPurchaseCost")?.value
                                                                    | indianCurrency ) : ' -- ' }}
                                                                </span>
                                                            </p>
                                                            <p
                                                                *ngIf="editNewPurchaseForm.get('purchaseDiscount').value">
                                                                Purchase Discount (added)
                                                                <span>₹
                                                                    {{ editNewPurchaseForm.get("purchaseDiscount").value
                                                                    || 0.00 | indianCurrency }}

                                                                </span>
                                                            </p>
                                                            <p *ngIf="editNewPurchaseForm.get('otherCharges').value">
                                                                Other Charges
                                                                <span>
                                                                    ₹
                                                                    {{ editNewPurchaseForm.get("otherCharges").value ||
                                                                    0.00 | indianCurrency }}
                                                                </span>
                                                            </p>
                                                            <p
                                                                *ngIf="editNewPurchaseForm.get('transportationCharges').value">
                                                                Transportation Charges
                                                                <span>
                                                                    ₹
                                                                    {{
                                                                    editNewPurchaseForm.get("transportationCharges").value
                                                                    || 0.00 | indianCurrency }}
                                                                </span>
                                                            </p>
                                                            <p *ngIf="editNewPurchaseForm.get('royaltyCharge')?.value">
                                                                Royalty Charges
                                                                <span>
                                                                    ₹
                                                                    {{ editNewPurchaseForm.get("royaltyCharge").value ||
                                                                    0.00 | indianCurrency }}
                                                                </span>
                                                            </p>
                                                            <!-- Expenses Section -->
                                                            <ng-container *ngIf="expenses && hasAnyPayment()">
                                                                <div class="mt-3 mb-2">
                                                                    <h5 class="expenses-title">Expenses</h5>
                                                                </div>
                                                                <ng-container
                                                                    *ngFor="let expense of expenses.controls; let i = index">
                                                                    <p>
                                                                        {{
                                                                        getExpenseTypeName(expense.get('type')?.value)
                                                                        }}
                                                                        <small class="text-muted ml-1">({{
                                                                            expense.get('paidBy')?.value }})</small>
                                                                        <span>
                                                                            ₹ {{ expense.get('payment')?.value || 0.00 |
                                                                            indianCurrency }}
                                                                        </span>
                                                                    </p>
                                                                </ng-container>
                                                            </ng-container>
                                                        </div>

                                                        <div class="invoice-total-footer"
                                                            *ngIf="lotTypeValue === 'Lot'">
                                                            <p *ngIf="ItemDetails?.transportationCharge === undefined">
                                                                Transport Charges / Ton<span> </span>
                                                            </p>
                                                            <p *ngIf="ItemDetails?.totalTransportationCharges">
                                                                Transport Charges<span>
                                                                    ₹ {{ ItemDetails?.totalTransportationCharges
                                                                    |indianCurrency }}
                                                                </span>
                                                            </p>
                                                            <p *ngIf="ItemDetails?.royaltyCharge">
                                                                Royalty Charges ( Other Charges )<span>
                                                                    ₹
                                                                    {{
                                                                    ItemDetails?.royaltyCharge |indianCurrency}}
                                                                </span>
                                                            </p>
                                                            <p *ngIf="ItemDetails?.royaltyCharge === undefined">
                                                                Royalty Charges ( Other Charges )<span> </span>
                                                            </p>
                                                            <p *ngIf="ItemDetails?.purchaseDiscount > 0">
                                                                Purchase Discount ( added )
                                                                <span>₹ {{ ItemDetails?.purchaseDiscount
                                                                    |indianCurrency}} </span>
                                                            </p>
                                                            <p class="mt-2"
                                                                *ngIf="editNewPurchaseForm.get('taxable')?.value">
                                                                Tax Applied Amount
                                                                <span>
                                                                    ₹
                                                                    {{
                                                                    editNewPurchaseForm.get('taxable')?.value
                                                                    | indianCurrency
                                                                    }}
                                                                </span>
                                                            </p>
                                                            <p class="mt-2"
                                                                *ngIf="editNewPurchaseForm.get('nonTaxable')?.value">
                                                                Non-Taxable Amount
                                                                <span>
                                                                    ₹
                                                                    {{
                                                                    editNewPurchaseForm.get('nonTaxable')?.value
                                                                    | indianCurrency
                                                                    }}
                                                                </span>
                                                            </p>
                                                            <h4 *ngIf="lotTypeValue === 'Lot'">
                                                                Total Purchase Cost
                                                                <span>
                                                                    {{ ItemDetails?.lotTotalCost
                                                                    ? '₹ ' + (ItemDetails.lotTotalCost | indianCurrency)
                                                                    : '₹ ' +
                                                                    (editNewPurchaseForm.get("paidToSupplierPurchaseCost")?.value
                                                                    |
                                                                    indianCurrency)
                                                                    }}
                                                                </span>
                                                            </h4>
                                                        </div>
                                                        <div class="invoice-total-footer"
                                                            *ngIf="lotTypeValue === 'slab'">
                                                            <p class="mt-2"
                                                                *ngIf="editNewPurchaseForm.get('taxable')?.value">
                                                                Tax Applied Amount
                                                                <span>
                                                                    ₹
                                                                    {{
                                                                    editNewPurchaseForm.get('taxable')?.value
                                                                    | indianCurrency
                                                                    }}
                                                                </span>
                                                            </p>
                                                            <p class="mt-2"
                                                                *ngIf="editNewPurchaseForm.get('nonTaxable')?.value">
                                                                Non-Taxable Amount
                                                                <span>
                                                                    ₹
                                                                    {{
                                                                    editNewPurchaseForm.get('nonTaxable')?.value
                                                                    | indianCurrency
                                                                    }}
                                                                </span>
                                                            </p>
                                                            <h4>
                                                                Total Purchase Cost
                                                                <span>
                                                                    {{
                                                                    editNewPurchaseForm.get('purchaseTotalAmount')?.value
                                                                    ?
                                                                    (editNewPurchaseForm.get('purchaseTotalAmount')?.value
                                                                    | indianCurrency)
                                                                    : null }}
                                                                </span>
                                                            </h4>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-flex pt-4 justify-content-between">
                                            <button type="button" class="btn btn-primary"
                                                (click)="backStep(prevCallback, 'Slab')">
                                                <i class="fa-solid fa-arrow-left"></i> Back
                                            </button>
                                            <button type="submit" class="border-0 btn btn-primary btn-gradient-primary">
                                                Submit
                                            </button>
                                        </div>
                                    </ng-template>
                                </p-stepperPanel>
                            </p-stepper>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>