<p-toast></p-toast>
<div class="card p-3">
    <form [formGroup]="slabAddForm" (ngSubmit)="slabAddFormSubmit()">
        <div class="row">
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-md-6 col-sm-12">
                        <h4>Product</h4>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                            <label for="warehouse">Product Type<span class="login-danger">*</span></label>
                            <p-dropdown [options]="productTypedata" appendTo="body" optionLabel="name" optionValue="_id"
                                placeholder="Select Product Type" formControlName="producttype" [style]="{ width: '100%' }"
                                [filter]="true" filterBy="name" [showClear]="true">
                            </p-dropdown>
                            <!-- {{ slabAddForm.get('warehouse')?.value}} -->
                            <div *ngIf="setValidations('producttype')">
                                <span class="login-danger">Field is required.</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                            <label for="vehicleNo">Vehicle Number</label>
                            <input class="form-control" type="text" placeholder="Enter Vehicle Number"
                                formControlName="vehicleNo" />
                            <div *ngIf="setValidations('vehicleNo')">
                                <span class="login-danger">Invalid vehicle number format. Please correct it.</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                            <label for="warehouse">Warehouse<span class="login-danger">*</span></label>
                            <p-dropdown [options]="wareHousedata" appendTo="body" optionLabel="name" optionValue="_id"
                                placeholder="Select Warehouse" formControlName="warehouse" [style]="{ width: '100%' }"
                                [filter]="true" filterBy="name" [showClear]="true">
                            </p-dropdown>
                            <!-- {{ slabAddForm.get('warehouse')?.value}} -->
                            <div *ngIf="setValidations('warehouse')">
                                <span class="login-danger">Field is required.</span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 col-sm-12 lot-details-h4">
                            <h4>Lot Details :</h4>
                        </div>
                    </div>

                    <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                            <label for="lotNo">Lot Number</label>
                            <input class="form-control" type="text" placeholder="Enter Lot Number"
                                formControlName="lotNo" />
                            <div *ngIf="setValidations('lotNo')">
                                <span class="login-danger">Invalid vehicle number format. Please correct it.</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                            <label for="lotName">Lot Name</label>
                            <input class="form-control" type="text" placeholder="Enter Lot Name"
                                formControlName="lotName" />
                            <div *ngIf="setValidations('lotName')">
                                <span class="login-danger">Invalid lot name format. Please correct it.</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                            <label for="lotWeight">Lot Weight/Ton</label>
                            <input class="form-control" type="text" placeholder="Enter Lot Weight/Ton"
                                formControlName="lotWeight" />
                            <div *ngIf="setValidations('lotWeight')">
                                <span class="login-danger">Invalid lot weight format. Please correct it.</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                            <label for="price">Price / Ton</label>
                            <input class="form-control" type="text" placeholder="Enter Price/Ton"
                                formControlName="price" />
                            <div *ngIf="setValidations('price')">
                                <span class="login-danger">Invalid Price/Ton format. Please correct it.</span>
                            </div>
                        </div>
                    </div>
                    

                    <div class="col-12">
                        <button type="button" class="border-0 btn btn-primary btn-gradient-primary m-r-10 mb-3"
                            (click)="addBlockDialog()" [disabled]="!slabAddForm.get('warehouse')?.value">
                            Add Block
                        </button>
                        <!-- [disabled]="!slabAddForm.valid" -->
                    </div>
                </div>
            </div>
        </div>

        <div class="row" *ngIf="slabDetails?.length > 0">
            <div class="col-sm-12">
                <div class="card card-table">
                    <div class="card-body">
                        <div class="page-table-header mb-2">
                            <div class="d-flex m-b-10" style="justify-content: space-between">
                                <h3>Slab List</h3>
                            </div>
                        </div>

                        <div class="row p-2">
                            <p-accordion [activeIndex]="[0]" [multiple]="true">
                                <p-accordionTab *ngFor="let data of slabDetails; let i = index; trackBy: trackByFn">
                                    <ng-template pTemplate="header">
                                        <span class="d-flex justify-content-between w-full">
                                            <span class="font-bold white-space-nowrap">
                                                Slab Number: {{ data?.slabNo }}
                                            </span>
                                            <p-button [text]="true" styleClass="w-2rem h-2rem p-0" icon="fa fa-trash"
                                                (click)="deleteAccordian(i)"></p-button>
                                        </span>
                                    </ng-template>

                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="card card-table show-entire">
                                                <div class="page-table-header mb-2 m-3">
                                                    <div class="row practice-card">
                                                        <div class="col-xl-6 col-lg-6 col-sm-12">
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Slab Name
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        {{ data?.slabName ?? ' -- '?? '--' }}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Length (Inch)
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        {{ data?.length ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Width (Inch)
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">{{ data?.width ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Thickness
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        {{ data?.thickness ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Finishes
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        {{ data?.finishes.name ?? ' -- ' }}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-xl-6 col-lg-6 col-sm-12">
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                  Quantity (Square Feet)
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                  <p class="col-form-label">
                                                                    {{ data?.totalSQFT ?? " -- " }}
                                                                  </p>
                                                                </div>
                                                              </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Rate / Sq. Feet
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        ₹ {{ data?.ratePerSqFeet ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Total Amount
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        ₹ {{ data?.totalCosting ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Number of Pieces
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        {{ data?.noOfPieces ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                       
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Cost Per SQFT
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        ₹ {{ data?.costPerSQFT ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </p-accordionTab>
                            </p-accordion>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </form>
   
</div>

<p-dialog header="Add Block" [(visible)]="addvisible" [modal]="true" [style]="{ width: '60%'}"
    (onHide)="closeSlabForm(myForm)">
    <div class="modal-content mt-2">
        <div class="modal-body">
            <form #myForm="ngForm">
                <div>
                    <div class="row">
                        <div class="col-12 col-md-6 col-xl-6">
                            <div class="form-group local-forms">
                                <label for="slabName">Marble / Stone Name</label>
                                <input class="form-control" type="text" placeholder="Enter Marble / Stone Name"
                                    pattern="^.{1,50}$" name="marbleName" [(ngModel)]="marbleName"
                                    (change)="getSlabDetails()" #MARBLENAME="ngModel" />
                            </div>
                        </div>

                        <div class="col-12 col-md-6 col-xl-6">
                            <div class="form-group local-forms">
                                <label for="slabNumber">Slab Number <span class="login-danger">*</span></label>
                                <input class="form-control" type="text" placeholder="Enter Slab Number"
                                    pattern="^.{1,50}$" required name="slabNumber" [(ngModel)]="slabNumber"
                                    (change)="getSlabDetails()" #SLABNUMBER="ngModel" />
                                <div *ngIf="SLABNUMBER.invalid && (SLABNUMBER.dirty || SLABNUMBER.touched)">
                                    <div *ngIf="SLABNUMBER.errors?.['required']">
                                        <span class="login-danger">Slab Number is required.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-md-6 col-xl-6">
                            <div class="form-group local-forms">
                                <label for="category">Category <span class="login-danger">*</span></label>
                                <p-dropdown [options]="CategoryListsEditArray" styleClass="" appendTo="body"
                                    optionLabel="name" optionValue="_id" placeholder="Select Category"
                                    [style]="{ width: '100%' }" [filter]="true" filterBy="name" [showClear]="false"
                                    required [(ngModel)]="category" #CATEGORY="ngModel" name="category" required
                                    (onChange)="findSubCategory($event.value)"></p-dropdown>
                                <!-- <div *ngIf="CATEGORY.invalid && (CATEGORY.dirty || CATEGORY.touched)">
                                        <div *ngIf="CATEGORY.errors?.['required']">
                                            <span class="login-danger">Category is required.</span>
                                        </div>
                                    </div> -->
                                <div *ngIf="CATEGORY.touched">
                                    <span class="login-danger" *ngIf="!category?.name">Category is required.</span>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-md-6 col-xl-6">
                            <div class="form-group local-forms">
                                <label for="subCategory">Sub Category<span class="login-danger">*</span></label>
                                <p-dropdown 
                                [options]="subCategorListByCategory" 
                                styleClass="" 
                                appendTo="body"
                                placeholder="Select Sub Category" 
                                optionLabel="name" 
                                optionValue="_id" 
                                (onChange)="getHsnCode($event.value)" 
                                [style]="{ width: '100%' }" 
                                [filter]="true" 
                                filterBy="name" 
                                [showClear]="false" 
                                required 
                                [(ngModel)]="subCategory" 
                                name="subCategory" 
                                #SUBCATEGORY="ngModel">
                              </p-dropdown>
                              
                                <!-- <div *ngIf="SUBCATEGORY.invalid && (SUBCATEGORY.dirty || SUBCATEGORY.touched)">
                                        <div *ngIf="SUBCATEGORY.errors?.['required']">
                                            <span class="login-danger">Sub Category is required.</span>
                                        </div>
                                    </div> -->
                                <div *ngIf="SUBCATEGORY.touched">
                                    <span class="login-danger" *ngIf="!subCategory?.name">Sub Category is
                                        required.</span>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-md-6 col-xl-6">
                            <div class="form-group local-forms">
                                <label for="noOfPieces">Number of Pieces <span class="login-danger">*</span> </label>
                                <input class="form-control" type="number" placeholder="Enter Number of Pieces"
                                    name="noOfPieces" (change)="getSlabDetails()" min="1" max="10000" required
                                    [(ngModel)]="noOfPieces" #NOOFPIECES="ngModel" />
                                <div *ngIf="NOOFPIECES.invalid && (NOOFPIECES.dirty || NOOFPIECES.touched)">
                                    <div *ngIf="NOOFPIECES.errors?.['required']">
                                        <span class="login-danger">Field is required.</span>
                                    </div>
                                    <div *ngIf="NOOFPIECES.errors?.['min'] || NOOFPIECES.errors?.['max']">
                                        <span class="login-danger">Number Of Pieces must be between 1 and 10000.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Length Field -->
                        <div class="col-12 col-md-6 col-xl-6 mt-2">
                            <div class="form-group local-forms">
                                <label for="length">Length </label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Inch</span>
                                    </div>
                                    <input class="form-control" type="number" id="length" name="length"
                                        (change)="getSlabDetails()" min="1" max="500" placeholder="Enter Length"
                                        [(ngModel)]="length" #LENGTH="ngModel" />
                                </div>
                                <div *ngIf="LENGTH.invalid && (LENGTH.dirty || LENGTH.touched)">
                                    <!-- <div *ngIf="LENGTH.errors?.['required']">
                  <span class="login-danger">Field is required.</span>
                </div> -->
                                    <div *ngIf="LENGTH.errors?.['min'] || LENGTH.errors?.['max']">
                                        <span class="login-danger">Length must be between 1 and 500.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Width Field -->
                        <div class="col-12 col-md-6 col-xl-6">
                            <div class="form-group local-forms">
                                <label for="width">Width </label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Inch</span>
                                    </div>
                                    <input class="form-control" type="number" id="width" name="width"
                                        (change)="getSlabDetails()" min="1" max="500" placeholder="Enter Width"
                                        [(ngModel)]="width" #WIDTH="ngModel" />
                                </div>
                                <div *ngIf="WIDTH.invalid && (WIDTH.dirty || WIDTH.touched)">
                                    <!-- <div *ngIf="WIDTH.errors?.['required']">
                  <span class="login-danger">Field is required.</span>
                </div> -->
                                    <div *ngIf="WIDTH.errors?.['min'] || WIDTH.errors?.['max']">
                                        <span class="login-danger">Width must be between 1 and 500.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Height Field -->
                        <div class="col-12 col-md-6 col-xl-6">
                            <div class="form-group local-forms">
                                <label for="thickness">Thickness </label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">MM</span>
                                    </div>
                                    <input class="form-control" type="number" id="thickness" name="thickness"
                                        (change)="getSlabDetails()" min="1" max="500" placeholder="Enter Thickness"
                                        [(ngModel)]="thickness" #THISCKNESS="ngModel" />
                                </div>
                                <div *ngIf="THISCKNESS.invalid && (THISCKNESS.dirty || THISCKNESS.touched)">
                                    <!-- <div *ngIf="THISCKNESS.errors?.['required']">
                                        <span class="login-danger">Field is required.</span>
                                    </div> -->
                                    <div *ngIf="THISCKNESS.errors?.['min'] || THISCKNESS.errors?.['max']">
                                        <span class="login-danger">Thickness must be between 1 and 500.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-md-6 col-xl-6">
                            <div class="form-group local-forms">
                                <label for="finishes">Finishes</label>
                                <p-dropdown [options]="finisheshList" styleClass="" appendTo="body" name="finishes"
                                    placeholder="Select finishes" optionLabel="name" [style]="{ width: '100%' }"
                                    [filter]="true" filterBy="name" [showClear]="true" [(ngModel)]="finishes"
                                    #FINISHESH="ngModel">
                                </p-dropdown>
                            </div>
                        </div>

                        <div class="col-12 col-md-6 col-xl-6">
                            <div class="form-group local-forms">
                                <label for="quantity">Quantity (Sq. Feet) <span class="login-danger">*</span> </label>
                                <input class="form-control" type="number" name="quantity" (change)="getSlabDetails()"
                                    min="1" max="1000000" placeholder="Enter Quantity" [(ngModel)]="quantity" required
                                    #QUANTITY="ngModel" />
                                <div *ngIf="QUANTITY.invalid && (QUANTITY.dirty || QUANTITY.touched)">
                                    <div *ngIf="QUANTITY.errors?.['required']">
                                        <span class="login-danger">Quantity is required.</span>
                                    </div>
                                    <div *ngIf="QUANTITY.errors?.['min'] || QUANTITY.errors?.['max']">
                                        <span class="login-danger">Quantity must be between 1 and 1000000.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-md-6 col-xl-6">
                            <div class="form-group local-forms">
                                <label for="ratePerSqFeet">Rate / Sq. Feet <span class="login-danger">*</span> </label>
                                <input class="form-control" type="number" placeholder="Enter Rate / Sq. Feet"
                                    name="ratePerSqFeet" (change)="getSlabDetails()" min="1" max="1000000"
                                    [(ngModel)]="ratePerSqFeet" #RATEPERSQFT="ngModel" required />
                                <div *ngIf="RATEPERSQFT.invalid && (RATEPERSQFT.dirty || RATEPERSQFT.touched)">
                                    <div *ngIf="RATEPERSQFT.errors?.['required']">
                                        <span class="login-danger">Ṛate / Sq. Feet is required.</span>
                                    </div>
                                    <div *ngIf="RATEPERSQFT.errors?.['min'] || RATEPERSQFT.errors?.['max']">
                                        <span class="login-danger">Rate / Sq. Feet must be between 1 and 1000000.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-md-6 col-xl-6">
                            <div class="form-group local-forms">
                                <label for="totalAmount">Total Amount <span class="login-danger">*</span> </label>
                                <input class="form-control" type="number" name="totalAmount" placeholder="Total Amount"
                                    [disabled]="true" [(ngModel)]="totalAmount" #TOTALAMOUNT="ngModel" />
                            </div>
                        </div>

                        <!-- check required for catgory and sub category -->
                        <div class="col-12">
                            <div class="settings-btns text-end m-b-10">
                                <button type="button" class="border-0 btn btn-primary btn-gradient-primary m-r-10"
                                    (click)="addSlabDetails(myForm) ; calculateTotalAmount()"
                                    [disabled]="myForm.invalid || !subCategory?.name || !category?.name">
                                    Save
                                </button>
                                <button type="button" class="btn btn-secondary" (click)="closeSlabForm(myForm)">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</p-dialog>