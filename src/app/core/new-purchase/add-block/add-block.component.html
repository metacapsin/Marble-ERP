<p-toast></p-toast>
<div class="card p-3">
    <form [formGroup]="purchaseAddForm" (ngSubmit)="purchaseAddFormSubmit()">
        <div class="row">
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-md-6 col-sm-12">
                        <h4>Product</h4>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                            <label for="producttype">Product Type<span class="login-danger">*</span></label>
                            <p-dropdown [options]="productTypedata" appendTo="body" optionLabel="name" optionValue="_id"
                                placeholder="Select Product Type" formControlName="producttype" [style]="{ width: '100%' }"
                                [filter]="true" filterBy="name" [showClear]="true">
                            </p-dropdown>
                            <!-- {{ purchaseAddForm.get('warehouse')?.value}} -->
                            <div *ngIf="setValidations('producttype')">
                                <span class="login-danger">Field is required.</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                            <label for="vehicleNo">Vehicle Number</label>
                            <input class="form-control" type="text" placeholder="Enter Vehicle Number"
                                formControlName="vehicleNo" />
                            <div *ngIf="setValidations('vehicleNo')">
                                <span class="login-danger">Invalid vehicle number format. Please correct it.</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="form-group local-forms">
                            <label for="warehouse">Warehouse<span class="login-danger">*</span></label>
                            <p-dropdown [options]="wareHousedata" appendTo="body" optionLabel="name" optionValue="_id"
                                placeholder="Select Warehouse" formControlName="warehouse" [style]="{ width: '100%' }"
                                [filter]="true" filterBy="name" [showClear]="true">
                            </p-dropdown>
                            <!-- {{ purchaseAddForm.get('warehouse')?.value}} -->
                            <div *ngIf="setValidations('warehouse')">
                                <span class="login-danger">Field is required.</span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 col-sm-12 lot-details-h4">
                            <h4>Lot Details :</h4>
                        </div>
                    </div>

                    <div class="col-12 col-md-4 col-xl-4">
                        <div class="form-group local-forms">
                          <label for="lotNo">Lot Number <span class="login-danger">*</span></label>
                          <input class="form-control" type="text" placeholder="Enter Lot Number" formControlName="lotNo" />
                          <div *ngIf="
                              purchaseAddForm.get('lotNo')?.hasError('required') &&
                              purchaseAddForm.get('lotNo')?.touched
                            ">
                            <span class="login-danger">Field is required.</span>
                          </div>
                          <div *ngIf="
                              purchaseAddForm.get('lotNo')?.hasError('pattern') &&
                              purchaseAddForm.get('lotNo')?.touched
                            ">
                            <span class="login-danger">Input Must be between 3 to 50 characters.</span>
                          </div>
                        </div>
                      </div>
                    <div class="col-12 col-md-4 col-xl-4">
                        <div class="form-group local-forms">
                          <label for="lotName">Lot Name <span class="login-danger">*</span></label>
                          <input class="form-control" type="text" placeholder="Enter Lot Name" formControlName="lotName" />
                          <div *ngIf="
                              purchaseAddForm.get('lotName')?.hasError('required') &&
                              purchaseAddForm.get('lotName')?.touched
                            ">
                            <span class="login-danger">Field is required.</span>
                          </div>
                          <div *ngIf="
                              purchaseAddForm.get('lotName')?.hasError('pattern') &&
                              purchaseAddForm.get('lotName')?.touched
                            ">
                            <span class="login-danger">Input Must be between 3 to 50 characters.</span>
                          </div>
                        </div>
                      </div>
                    <div class="col-12 col-md-4 col-xl-4">
                        <div class="form-group local-forms">
                          <label for="lotWeight">Lot Weight (Ton) <span class="login-danger">*</span></label>
                          <input class="form-control" type="number" placeholder="Enter Lot Weight In Ton"
                            (change)="calculateTotalAmount()" formControlName="lotWeight" />
                          <div *ngIf="
                              purchaseAddForm.get('lotWeight')?.hasError('required') &&
                              purchaseAddForm.get('lotWeight')?.touched
                            ">
                            <span class="login-danger">Field is required.</span>
                          </div>
                          <div *ngIf="
                              (purchaseAddForm.get('lotWeight')?.hasError('min') &&
                                purchaseAddForm.get('lotWeight')?.touched) ||
                              (purchaseAddForm.get('lotWeight')?.hasError('max') &&
                                purchaseAddForm.get('lotWeight')?.touched)
                            ">
                            <span class="login-danger">Input Must be between 1 to 10000.
                            </span>
                          </div>
                        </div>
                      </div>
                  
          <div class="col-12 col-md-4">
            <div class="form-group local-forms">
              <label for="pricePerTon">Price / Ton<span class="login-danger">*</span></label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">₹</span>
                </div>
                <!-- <span class="form-control">{{
                  lotAddForm.get("pricePerTon").value
                  }}</span> -->
                <input class="form-control" type="number" placeholder="Enter Price / Ton"
                  (change)="calculateTotalAmount()" formControlName="pricePerTon" />
              </div>
              <!-- <span style="color: #97704f; font-size: 12px">This will be auto calculated with Purchase Cost</span> -->
              <div *ngIf="
                  purchaseAddForm.get('pricePerTon')?.hasError('required') &&
                  purchaseAddForm.get('pricePerTon')?.touched
                ">
                <span class="login-danger">Field is required.</span>
              </div>
              <div *ngIf="
                  (purchaseAddForm.get('pricePerTon')?.hasError('min') &&
                    purchaseAddForm.get('pricePerTon')?.touched) ||
                  (purchaseAddForm.get('pricePerTon')?.hasError('max') &&
                    purchaseAddForm.get('pricePerTon')?.touched)
                ">
                <span class="login-danger">Input Must be between 1 to 1000000.
                </span>
              </div>
            </div>
          </div>
                    

                    <div class="col-12">
                        <button type="button" class="border-0 btn btn-primary btn-gradient-primary m-r-10 mb-3"
                        (click)="addBlockDialog()" [disabled]="!purchaseAddForm.get('warehouse')?.value || !purchaseAddForm.get('producttype')?.value || !purchaseAddForm.get('lotNo')?.value || !purchaseAddForm.get('lotName')?.value || !purchaseAddForm.get('lotWeight')?.value || !purchaseAddForm.get('pricePerTon')?.value">                            Add Block
                        </button>
                        <!-- [disabled]="!purchaseAddForm.valid" -->
                    </div>
                </div>
            </div>
        </div>

        <div class="row" *ngIf="slabDetails?.length > 0">
            <div class="col-sm-12">
                <div class="card card-table">
                    <div class="card-body">
                        <div class="page-table-header mb-2">
                            <div class="d-flex m-b-10" style="justify-content: space-between">
                                <h3>Block List</h3>
                            </div>
                        </div>

                        <div class="row p-2">
                            <p-accordion [activeIndex]="[0]" [multiple]="true">
                                <p-accordionTab *ngFor="let data of slabDetails; let i = index; trackBy: trackByFn">
                                    <ng-template pTemplate="header">
                                        <span class="d-flex justify-content-between w-full">
                                            <span class="font-bold white-space-nowrap">
                                                Block Number: {{ data?.slabNo }}
                                            </span>
                                            <p-button [text]="true" styleClass="w-2rem h-2rem p-0" icon="fa fa-trash"
                                                (click)="deleteAccordian(i)"></p-button>
                                        </span>
                                    </ng-template>

                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="card card-table show-entire">
                                                <div class="page-table-header mb-2 m-3">
                                                    <div class="row practice-card">
                                                        <div class="col-xl-6 col-lg-6 col-sm-12">
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Slab Name
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        {{ data?.slabName ?? ' -- '?? '--' }}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Length (Inch)
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        {{ data?.length ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Width (Inch)
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">{{ data?.width ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Thickness
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        {{ data?.thickness ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Finishes
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        {{ data?.finishes.name ?? ' -- ' }}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-xl-6 col-lg-6 col-sm-12">
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                  Quantity (Square Feet)
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                  <p class="col-form-label">
                                                                    {{ data?.totalSQFT ?? " -- " }}
                                                                  </p>
                                                                </div>
                                                              </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Rate / Sq. Feet
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        ₹ {{ data?.ratePerSqFeet ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Total Amount
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        ₹ {{ data?.totalCosting ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Number of Pieces
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        {{ data?.noOfPieces ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                       
                                                            <div class="form-group row mb-2">
                                                                <h5 class="col-lg-4 col-md-4 col-xl-4 col-form-label">
                                                                    Cost Per SQFT
                                                                </h5>
                                                                <div class="col-lg-8 col-md-8 col-xl-8">
                                                                    <p class="col-form-label">
                                                                        ₹ {{ data?.costPerSQFT ?? ' -- '}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </p-accordionTab>
                            </p-accordion>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </form>
   
</div>

<p-dialog [(visible)]="addvisible" [modal]="true" [style]="{ width: '650px'}"
    (onHide)="closeSlabForm(myForm)" styleClass="add-block-dialog" [showHeader]="false">
    <div class="dialog-content">
        <div class="dialog-header">
            <div class="dialog-title"><strong>Add Block</strong></div>
            <div class="unit-selector">
                Unit : Inch <i class="pi pi-chevron-down"></i>
            </div>
            <button type="button" class="close-btn" (click)="closeSlabForm(myForm)">
                ×
            </button>
        </div>
        <div class="form-container">
            <form #myForm="ngForm">
                <div class="form-row">
                    <div class="form-group local-forms">
                        <label for="category">Category <span class="login-danger">*</span></label>
                        <p-dropdown [options]="CategoryListsEditArray" styleClass="" appendTo="body" optionLabel="name"
                          optionValue="_id" placeholder="Select Category" formControlName="categoryDetail"
                          [style]="{ width: '100%' }" [filter]="true" filterBy="name" [showClear]="false"
                          (onChange)="findSubCategory($event.value)">
                        </p-dropdown>
                        <div *ngIf="
                            purchaseAddForm
                              .get('categoryDetail')
                              ?.hasError('required') &&
                            purchaseAddForm.get('categoryDetail')?.touched
                          ">
                          <span class="login-danger">Field is required.</span>
                        </div>
                      </div>

                      <div class="form-group local-forms">
                        <label for="subCategory">Sub Category <span class="login-danger">*</span></label>
                        <p-dropdown [options]="subCategorListByCategory" styleClass="" appendTo="body" optionValue="_id"
                          placeholder="Select Sub Category" optionLabel="name" formControlName="subCategoryDetail"
                          [style]="{ width: '100%' }" [filter]="true" filterBy="name" [showClear]="false">
                        </p-dropdown>
                        <div *ngIf="
                            purchaseAddForm
                              .get('subCategoryDetail')
                              ?.hasError('required') &&
                            purchaseAddForm.get('subCategoryDetail')?.touched
                          ">
                          <span class="login-danger">Field is required.</span>
                        </div>
                      </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="blockNumber">Block Number</label>
                        <input class="form-control" type="text" placeholder="Block Number"
                            pattern="^.{1,50}$" required name="slabNumber" [(ngModel)]="slabNumber"
                            (change)="getSlabDetails()" #SLABNUMBER="ngModel" />
                    </div>

                    <div class="form-col">
                        <label for="length">Length</label>
                        <input class="form-control" type="number" id="length" name="length"
                            (change)="getSlabDetails()" min="1" max="500" placeholder="Length"
                            [(ngModel)]="length" #LENGTH="ngModel" />
                    </div>

                </div>

                <div class="form-row">
                   
                    <div class="form-col">
                        <label for="width">Width</label>
                        <input class="form-control" type="number" id="width" name="width"
                            (change)="getSlabDetails()" min="1" max="500" placeholder="Width"
                            [(ngModel)]="width" #WIDTH="ngModel" />
                    </div>

                    <div class="form-col">
                        <label for="height">Height</label>
                        <input class="form-control" type="number" id="thickness" name="thickness"
                            (change)="getSlabDetails()" min="1" max="500" placeholder="Height"
                            [(ngModel)]="thickness" #THISCKNESS="ngModel" />
                    </div>
                </div>

                <div class="form-row">
                 

                    <div class="form-col">
                        <label for="blockSize">Block Size (inch²)</label>
                        <input class="form-control" type="text" placeholder="Block Size"
                            name="blockSize" [(ngModel)]="blockSize" />
                    </div>

                    <div class="form-col">
                        <label for="blockProcessor">Block Processor</label>
                        <div class="dropdown-container">
                            <p-dropdown [options]="finisheshList" styleClass="w-100" appendTo="body" name="blockProcessor"
                                placeholder="Royal Edge Stone Works" optionLabel="name" [style]="{ width: '100%' }"
                                [filter]="true" filterBy="name" [showClear]="true" [(ngModel)]="finishes"
                                #FINISHESH="ngModel">
                            </p-dropdown>
                        </div>
                    </div>
                </div>

                <div class="form-row no-border">
                    <div class="form-col">
                        <label for="blockCode">Block Code</label>
                        <div class="block-code-container">
                            <input class="form-control" type="text" placeholder="Block Code"
                                name="blockCode" [(ngModel)]="blockCode" />
                            <div class="code-icons">
                                <button pButton type="button" icon="pi pi-qrcode" class="p-button-secondary p-button-sm"></button>
                                <button pButton type="button" icon="pi pi-camera" class="p-button-secondary p-button-sm"></button>
                            </div>
                        </div>
                    </div>

                    <div class="form-col">
                        <label for="blockPhotos">Block Photos</label>
                        <div class="photo-upload-area">
                            <div class="photo-item"></div>
                            <div class="photo-item"></div>
                            <div class="photo-item"></div>
                            <div class="photo-item"></div>
                            <div class="photo-item photos-add-btn">
                                <button pButton type="button" icon="pi pi-images" class="p-button-text p-button-rounded p-button-sm add-photos-btn"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="dialog-footer">
            <div class="footer-buttons">
                <button type="button" class="btn-save"
                    (click)="addSlabDetails(myForm) ; calculateTotalAmount()"
                    >
                    Save
                </button>
                <button type="button" class="btn-cancel" (click)="closeSlabForm(myForm)">
                    Cancel
                </button>
            </div>
            <div class="add-more-link">
                <a href="javascript:void(0)" class="add-more-block">
                    <strong>Add More Block</strong>
                </a>
            </div>
        </div>
    </div>
</p-dialog>