<!-- Page Header -->
<!-- /Page Header -->

<div class="col-sm-12">
  <div class="card card-table show-entire">
    <div class="page-table-header mb-2">
      <div class="row align-items-center">
        <div class="col">
          <div class="doctor-table-blk">
            <h3>Ledger Pay Dashboard</h3>
          </div>
        </div>
        <div class="col-auto">
          <div class="add-group textbtn">
            <a [routerLink]="['/ledger-pay/entry']" class="btn btn-primary">
              <i class="feather icon-plus-circle me-2"></i>New Payment
            </a>
          </div>
        </div>
      </div>
    </div>
    <div class="card-body p-2">
      <!-- Filters -->
      <div class="row mb-4">
        <div class="col-sm-12">
          <div class="card doctor-list-blk">
            <div class="card-body">
              <div class="row">
                <div class="col-md-3">
                  <div class="form-group local-forms">
                    <label>Date Range</label>
                    <p-calendar [(ngModel)]="dateRange" selectionMode="range" [showIcon]="true" styleClass="w-100" (onSelect)="onDateRangeChange($event)"></p-calendar>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-group local-forms">
                    <label>Payment Type</label>
                    <p-dropdown [options]="paymentTypes" [(ngModel)]="selectedPaymentType" placeholder="All Types" styleClass="w-100" (onChange)="onPaymentTypeChange($event)"></p-dropdown>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-group local-forms">
                    <div class="d-flex gap-2">
                      <button type="button" class="btn btn-primary btn-gradient-primary flex-grow-1" (click)="applyFilters()">
                        <i class="feather icon-filter me-2"></i>Apply Filters
                      </button>
                      <button type="button" class="btn btn-secondary flex-grow-1" (click)="resetFilters()">
                        <i class="feather icon-refresh-cw me-2"></i>Reset
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card doctor-list-blk" style="height: 120px;">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h5 class="card-title">Today's Payments</h5>
                  <h3 class="mb-0">{{todayPayments | number:'1.2-2'}}</h3>
                </div>
                <div class="icon-box">
                  <i class="feather icon-dollar-sign"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card doctor-list-blk" style="height: 120px;">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h5 class="card-title">Outstanding Receivables</h5>
                  <h3 class="mb-0">{{outstandingReceivables | number:'1.2-2'}}</h3>
                  <small>{{receivablesCount}} invoices</small>
                </div>
                <div class="icon-box">
                  <i class="feather icon-arrow-down"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card doctor-list-blk" style="height: 120px;">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h5 class="card-title">Outstanding Payables</h5>
                  <h3 class="mb-0">{{outstandingPayables | number:'1.2-2'}}</h3>
                  <small>{{payablesCount}} invoices</small>
                </div>
                <div class="icon-box">
                  <i class="feather icon-arrow-up"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card doctor-list-blk" style="height: 120px;">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h5 class="card-title">Net Cash Flow</h5>
                  <h3 class="mb-0" [ngClass]="{'text-success': netCashFlow >= 0, 'text-danger': netCashFlow < 0}">
                    {{netCashFlow | number:'1.2-2'}}
                  </h3>
                </div>
                <div class="icon-box">
                  <i class="feather icon-trending-up"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Payments Table -->
      <div class="row">
        <div class="col-12">
          <div class="page-table-header mb-2">
            <div class="row align-items-center">
              <div class="col">
                <h5 class="card-title">Recent Payments</h5>
              </div>
              <div class="col-auto">
                <div class="top-nav-search table-search-blk">
                  <input type="text" class="form-control" placeholder="Search here" [(ngModel)]="searchQuery">
                  <!-- <a class="btn"><img src="assets/img/icons/search-normal.svg" alt=""></a> -->
                </div>
              </div>
            </div>
          </div>
          <p-table
            [value]="recentPayments"
            [loading]="loading"
            styleClass="p-datatable-striped"
            [tableStyle]="{ 'min-width': '60rem' }"
            [paginator]="recentPayments?.length >= 5"
            [rows]="10"
            [rowsPerPageOptions]="[5, 10, 20]"
            (change)="onPageChange($event)"
            selectionMode="multiple"
            #dt
            [columns]="cols"
            [exportHeader]="'customExportHeader'"
            exportFilename="RecentPayments">
            
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="date">
                  Date <p-sortIcon field="date"></p-sortIcon>
                  <p-columnFilter
                    matchMode="contains"
                    hideOnClear="true"
                    type="text"
                    field="date"
                    display="menu"
                  ></p-columnFilter>
                </th>
                <th pSortableColumn="ledgerName">
                  Ledger Name <p-sortIcon field="ledgerName"></p-sortIcon>
                  <p-columnFilter
                    matchMode="contains"
                    hideOnClear="true"
                    type="text"
                    field="ledgerName"
                    display="menu"
                  ></p-columnFilter>
                </th>
                <th pSortableColumn="paymentType">
                  Payment Type <p-sortIcon field="paymentType"></p-sortIcon>
                  <p-columnFilter
                    matchMode="contains"
                    hideOnClear="true"
                    type="text"
                    field="paymentType"
                    display="menu"
                  ></p-columnFilter>
                </th>
                <th pSortableColumn="amount">
                  Amount <p-sortIcon field="amount"></p-sortIcon>
                  <p-columnFilter
                    matchMode="contains"
                    hideOnClear="true"
                    type="text"
                    field="amount"
                    display="menu"
                  ></p-columnFilter>
                </th>
                <th pSortableColumn="reference">
                  Reference <p-sortIcon field="reference"></p-sortIcon>
                  <p-columnFilter
                    matchMode="contains"
                    hideOnClear="true"
                    type="text"
                    field="reference"
                    display="menu"
                  ></p-columnFilter>
                </th>
                <th pSortableColumn="status">
                  Status <p-sortIcon field="status"></p-sortIcon>
                  <p-columnFilter
                    matchMode="contains"
                    hideOnClear="true"
                    type="text"
                    field="status"
                    display="menu"
                  ></p-columnFilter>
                </th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-payment>
              <tr>
                <td class="bold">{{payment.date | date:'dd-MMM-yyyy'}}</td>
                <td class="bold">{{payment.ledgerName}}</td>
                <td>
                  <span [class]="payment.paymentType === 'Payment In' ? 'badge bg-success' : 'badge bg-danger'">
                    {{payment.paymentType}}
                  </span>
                </td>
                <td class="bold">{{payment.amount | number:'1.2-2'}}</td>
                <td class="bold">{{payment.reference}}</td>
                <td>
                  <span [class]="payment.status === 'Completed' ? 'badge bg-success' : 'badge bg-warning'">
                    {{payment.status}}
                  </span>
                </td>
              </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="6" class="text-center">No recent payments found</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
  </div>
</div> 